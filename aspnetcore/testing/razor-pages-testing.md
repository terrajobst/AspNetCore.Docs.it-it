---
title: "Unità di pagine Razor e integrazione test in ASP.NET Core"
author: guardrex
description: Informazioni su come creare unit test e integrazione test per App pagine Razor.
ms.author: riande
manager: wpickett
ms.custom: mvc
ms.date: 11/27/2017
ms.topic: article
ms.technology: aspnet
ms.prod: asp.net-core
uid: testing/razor-pages-testing
ms.openlocfilehash: 1ecdf010f7c283a0a08b224d570a5bc5cdf536df
ms.sourcegitcommit: 281f0c614543a6c3db565ea4655b70fe49b61d84
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/03/2018
---
# <a name="razor-pages-unit-and-integration-testing-in-aspnet-core"></a><span data-ttu-id="5ec2c-103">Unità di pagine Razor e integrazione test in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="5ec2c-103">Razor Pages unit and integration testing in ASP.NET Core</span></span>

<span data-ttu-id="5ec2c-104">Di [Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="5ec2c-104">By [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="5ec2c-105">ASP.NET Core supporta unità e test di integrazione di App pagine Razor.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-105">ASP.NET Core supports unit and integration testing of Razor Pages apps.</span></span> <span data-ttu-id="5ec2c-106">Il livello di accesso ai dati (DAL), modelli di pagina e componenti della pagina integrata garantirà:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-106">Testing the data access layer (DAL), page models, and integrated page components helps ensure:</span></span>

* <span data-ttu-id="5ec2c-107">Parti di un'app di pagine Razor funzionano in modo indipendente e insieme come una singola unità durante la costruzione di app.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-107">Parts of a Razor Pages app work independently and together as a unit during app construction.</span></span>
* <span data-ttu-id="5ec2c-108">Classi e metodi limitata gli ambiti di responsabilità.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-108">Classes and methods have limited scopes of responsibility.</span></span>
* <span data-ttu-id="5ec2c-109">Documentazione aggiuntiva esiste sul comportamento di app.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-109">Additional documentation exists on how the app should behave.</span></span>
* <span data-ttu-id="5ec2c-110">Regressioni, ovvero errori nasce da aggiornamenti al codice, sono disponibili durante la distribuzione e la compilazione automatizzata.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-110">Regressions, which are errors brought about by updates to the code, are found during automated building and deployment.</span></span>

<span data-ttu-id="5ec2c-111">In questo argomento si presuppone una conoscenza di base delle pagine Razor App unit test e integrazione test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-111">This topic assumes that you have a basic understanding of Razor Pages apps, unit testing, and integration testing.</span></span> <span data-ttu-id="5ec2c-112">Se non si ha familiarità con App pagine Razor o test concetti, vedere gli argomenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-112">If you're unfamiliar with Razor Pages apps or testing concepts, see the following topics:</span></span>

* [<span data-ttu-id="5ec2c-113">Introduzione a Razor Pages in ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="5ec2c-113">Introduction to Razor Pages</span></span>](xref:mvc/razor-pages/index)
* [<span data-ttu-id="5ec2c-114">Introduzione a Razor Pages</span><span class="sxs-lookup"><span data-stu-id="5ec2c-114">Getting started with Razor Pages</span></span>](xref:tutorials/razor-pages/razor-pages-start)
* [<span data-ttu-id="5ec2c-115">Unit test c# in .NET Core usando xUnit e test dotnet</span><span class="sxs-lookup"><span data-stu-id="5ec2c-115">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* [<span data-ttu-id="5ec2c-116">Test di integrazione</span><span class="sxs-lookup"><span data-stu-id="5ec2c-116">Integration testing</span></span>](xref:testing/integration-testing)

<span data-ttu-id="5ec2c-117">[Visualizzare o scaricare il codice di esempio](https://github.com/aspnet/Docs/tree/master/aspnetcore/testing/razor-pages-testing/sample/) ([procedura per il download](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="5ec2c-117">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/testing/razor-pages-testing/sample/) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

<span data-ttu-id="5ec2c-118">Il progetto di esempio è costituito da due applicazioni:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-118">The sample project is composed of two apps:</span></span>

| <span data-ttu-id="5ec2c-119">App</span><span class="sxs-lookup"><span data-stu-id="5ec2c-119">App</span></span>         | <span data-ttu-id="5ec2c-120">Cartella di progetto</span><span class="sxs-lookup"><span data-stu-id="5ec2c-120">Project folder</span></span>                        | <span data-ttu-id="5ec2c-121">Descrizione</span><span class="sxs-lookup"><span data-stu-id="5ec2c-121">Description</span></span> |
| ----------- | ------------------------------------- | ----------- |
| <span data-ttu-id="5ec2c-122">App di messaggio</span><span class="sxs-lookup"><span data-stu-id="5ec2c-122">Message app</span></span> | <span data-ttu-id="5ec2c-123">*src/RazorPagesTestingSample*</span><span class="sxs-lookup"><span data-stu-id="5ec2c-123">*src/RazorPagesTestingSample*</span></span>         | <span data-ttu-id="5ec2c-124">Consente di aggiungere, eliminare uno, eliminare tutti e analizzare i messaggi.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-124">Allows a user to add, delete one, delete all, and analyze messages.</span></span> |
| <span data-ttu-id="5ec2c-125">App di test</span><span class="sxs-lookup"><span data-stu-id="5ec2c-125">Test app</span></span>    | <span data-ttu-id="5ec2c-126">*tests/RazorPagesTestingSample.Tests*</span><span class="sxs-lookup"><span data-stu-id="5ec2c-126">*tests/RazorPagesTestingSample.Tests*</span></span> | <span data-ttu-id="5ec2c-127">Usato per testare l'app del messaggio.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-127">Used to test the message app.</span></span><ul><li><span data-ttu-id="5ec2c-128">Unit test: livello di accesso ai dati (DAL), il modello di pagina di indice</span><span class="sxs-lookup"><span data-stu-id="5ec2c-128">Unit tests: Data access layer (DAL), Index page model</span></span></li><li><span data-ttu-id="5ec2c-129">Test di integrazione: pagina di indice</span><span class="sxs-lookup"><span data-stu-id="5ec2c-129">Integration tests: Index page</span></span></li></ul> |

<span data-ttu-id="5ec2c-130">È possibile eseguire i test utilizzando le funzionalità di test predefinite dell'IDE, ad esempio [Visual Studio](https://www.visualstudio.com/vs/).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-130">The tests can be run using the built-in testing features of an IDE, such as [Visual Studio](https://www.visualstudio.com/vs/).</span></span> <span data-ttu-id="5ec2c-131">Se si utilizza [codice di Visual Studio](https://code.visualstudio.com/) o la riga di comando, eseguire il comando seguente al prompt dei comandi nel *tests/RazorPagesTestingSample.Tests* cartella:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-131">If using [Visual Studio Code](https://code.visualstudio.com/) or the command line, execute the following command at a command prompt in the *tests/RazorPagesTestingSample.Tests* folder:</span></span>

```console
dotnet test
```

## <a name="message-app-organization"></a><span data-ttu-id="5ec2c-132">Organizzazione di app di messaggio</span><span class="sxs-lookup"><span data-stu-id="5ec2c-132">Message app organization</span></span>

<span data-ttu-id="5ec2c-133">L'applicazione di messaggio è un semplice sistema messaggio Razor pagine con le caratteristiche seguenti:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-133">The message app is a simple Razor Pages message system with the following characteristics:</span></span>

* <span data-ttu-id="5ec2c-134">La pagina di indice dell'app (*Pages/Index.cshtml* e *Pages/Index.cshtml.cs*) fornisce un'interfaccia utente e una pagina di metodi del modello per controllare l'aggiunta, eliminazione e l'analisi dei messaggi (parole medie per ogni messaggio) .</span><span class="sxs-lookup"><span data-stu-id="5ec2c-134">The Index page of the app (*Pages/Index.cshtml* and *Pages/Index.cshtml.cs*) provides a UI and page model methods to control the addition, deletion, and analysis of messages (average words per message).</span></span>
* <span data-ttu-id="5ec2c-135">Viene descritto un messaggio dal `Message` classe (*Data/Message.cs*) con due proprietà: `Id` (chiave) e `Text` (messaggio).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-135">A message is described by the `Message` class (*Data/Message.cs*) with two properties: `Id` (key) and `Text` (message).</span></span> <span data-ttu-id="5ec2c-136">Il `Text` proprietà è necessaria e limitata a 200 caratteri.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-136">The `Text` property is required and limited to 200 characters.</span></span>
* <span data-ttu-id="5ec2c-137">I messaggi vengono archiviati utilizzando [database in memoria di Entity Framework](/ef/core/providers/in-memory/)&#8224;.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-137">Messages are stored using [Entity Framework's in-memory database](/ef/core/providers/in-memory/)&#8224;.</span></span>
* <span data-ttu-id="5ec2c-138">L'app contiene un livello di accesso ai dati (DAL) nella relativa classe di contesto di database, `AppDbContext` (*Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-138">The app contains a data access layer (DAL) in its database context class, `AppDbContext` (*Data/AppDbContext.cs*).</span></span> <span data-ttu-id="5ec2c-139">I metodi DAL sono contrassegnati `virtual`, che consente a tali i metodi da utilizzare nei test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-139">The DAL methods are marked `virtual`, which allows mocking the methods for use in the tests.</span></span>
* <span data-ttu-id="5ec2c-140">Se il database è vuoto all'avvio dell'app, l'archivio di messaggi viene inizializzato con tre messaggi.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-140">If the database is empty on app startup, the message store is initialized with three messages.</span></span> <span data-ttu-id="5ec2c-141">Questi *seeding messaggi* vengono inoltre utilizzati nel test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-141">These *seeded messages* are also used in testing.</span></span>

<span data-ttu-id="5ec2c-142">&#8224; L'argomento EF [test con InMemory](/ef/core/miscellaneous/testing/in-memory), viene illustrato come utilizzare un database in memoria per il test con MSTest.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-142">&#8224;The EF topic, [Testing with InMemory](/ef/core/miscellaneous/testing/in-memory), explains how to use an in-memory database for testing with MSTest.</span></span> <span data-ttu-id="5ec2c-143">Questo argomento viene utilizzato il [xUnit](https://xunit.github.io/) framework di test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-143">This topic uses the [xUnit](https://xunit.github.io/) testing framework.</span></span> <span data-ttu-id="5ec2c-144">Le implementazioni di test in diversi framework di test e test concetti sono simili ma non identica.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-144">Testing concepts and test implementations across different testing frameworks are similar but not identical.</span></span>

<span data-ttu-id="5ec2c-145">Anche se l'app non usa il [modello di repository](http://martinfowler.com/eaaCatalog/repository.html) e non è un esempio efficace del [modello unità di lavoro (UoW)](https://martinfowler.com/eaaCatalog/unitOfWork.html), pagine Razor supporta questi modelli di sviluppo.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-145">Although the app doesn't use the [repository pattern](http://martinfowler.com/eaaCatalog/repository.html) and isn't an effective example of the [Unit of Work (UoW) pattern](https://martinfowler.com/eaaCatalog/unitOfWork.html), Razor Pages supports these patterns of development.</span></span> <span data-ttu-id="5ec2c-146">Per ulteriori informazioni, vedere [progettazione del livello di persistenza infrastruttura](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design), [implementazione del Repository e schemi di unità di lavoro in un'applicazione MVC ASP.NET](/aspnet/mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application), e [test logica di controller](/aspnet/core/mvc/controllers/testing) (l'esempio implementa il modello di repository).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-146">For more information, see [Designing the infrastructure persistence layer](/dotnet/standard/microservices-architecture/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design), [Implementing the Repository and Unit of Work Patterns in an ASP.NET MVC Application](/aspnet/mvc/overview/older-versions/getting-started-with-ef-5-using-mvc-4/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application), and [Testing controller logic](/aspnet/core/mvc/controllers/testing) (the sample implements the repository pattern).</span></span>

## <a name="test-app-organization"></a><span data-ttu-id="5ec2c-147">Organizzazione di app di test</span><span class="sxs-lookup"><span data-stu-id="5ec2c-147">Test app organization</span></span>

<span data-ttu-id="5ec2c-148">L'applicazione di test è un'applicazione console all'interno di *tests/RazorPagesTestingSample.Tests* cartella:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-148">The test app is a console app inside the *tests/RazorPagesTestingSample.Tests* folder:</span></span>

| <span data-ttu-id="5ec2c-149">Cartella di app di test</span><span class="sxs-lookup"><span data-stu-id="5ec2c-149">Test app folder</span></span>    | <span data-ttu-id="5ec2c-150">Descrizione</span><span class="sxs-lookup"><span data-stu-id="5ec2c-150">Description</span></span> |
| ------------------ | ----------- |
| <span data-ttu-id="5ec2c-151">*IntegrationTests*</span><span class="sxs-lookup"><span data-stu-id="5ec2c-151">*IntegrationTests*</span></span> | <ul><li><span data-ttu-id="5ec2c-152">*IndexPageTest.cs* contiene i test di integrazione per la pagina di indice.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-152">*IndexPageTest.cs* contains the integration tests for the Index page.</span></span></li><li><span data-ttu-id="5ec2c-153">*TestFixture.cs* crea l'host di test per testare l'app del messaggio.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-153">*TestFixture.cs* creates the test host to test the message app.</span></span></li></ul> |
| <span data-ttu-id="5ec2c-154">*UnitTests*</span><span class="sxs-lookup"><span data-stu-id="5ec2c-154">*UnitTests*</span></span>        | <ul><li><span data-ttu-id="5ec2c-155">*DataAccessLayerTest.cs* contiene unit test per DAL.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-155">*DataAccessLayerTest.cs* contains the unit tests for the DAL.</span></span></li><li><span data-ttu-id="5ec2c-156">*IndexPageTest.cs* contiene unit test per il modello di pagina di indice.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-156">*IndexPageTest.cs* contains the unit tests for the Index page model.</span></span></li></ul> |
| <span data-ttu-id="5ec2c-157">*Utilità*</span><span class="sxs-lookup"><span data-stu-id="5ec2c-157">*Utilities*</span></span>        | <span data-ttu-id="5ec2c-158">*Utilities.cs* contiene il:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-158">*Utilities.cs* contains the:</span></span><ul><li><span data-ttu-id="5ec2c-159">`TestingDbContextOptions`metodo utilizzato per creare le opzioni di contesto per ogni unit test DAL nuovo database in modo che il database viene reimpostato per la condizione della linea di base per ogni test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-159">`TestingDbContextOptions` method used to create new database context options for each DAL unit test so that the database is reset to its baseline condition for each test.</span></span></li><li><span data-ttu-id="5ec2c-160">`GetRequestContentAsync`metodo utilizzato per preparare il `HttpClient` e contenuto per le richieste inviate all'app messaggio durante il test di integrazione.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-160">`GetRequestContentAsync` method used to prepare the `HttpClient` and content for requests that are sent to the message app during integration testing.</span></span></li></ul>

<span data-ttu-id="5ec2c-161">Il framework di test è [xUnit](https://xunit.github.io/).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-161">The test framework is [xUnit](https://xunit.github.io/).</span></span> <span data-ttu-id="5ec2c-162">L'oggetto tali framework è [Moq](https://github.com/moq/moq4).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-162">The object mocking framework is [Moq](https://github.com/moq/moq4).</span></span> <span data-ttu-id="5ec2c-163">Test di integrazione vengono effettuate con il [Host di Test ASP.NET Core](xref:testing/integration-testing#the-test-host).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-163">Integration tests are conducted using the [ASP.NET Core Test Host](xref:testing/integration-testing#the-test-host).</span></span>

## <a name="unit-testing-the-data-access-layer-dal"></a><span data-ttu-id="5ec2c-164">Unit test a livello di accesso ai dati (DAL)</span><span class="sxs-lookup"><span data-stu-id="5ec2c-164">Unit testing the data access layer (DAL)</span></span>

<span data-ttu-id="5ec2c-165">L'app del messaggio ha DAL con quattro metodi contenuti nel `AppDbContext` classe (*src/RazorPagesTestingSample/Data/AppDbContext.cs*).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-165">The message app has a DAL with four methods contained in the `AppDbContext` class (*src/RazorPagesTestingSample/Data/AppDbContext.cs*).</span></span> <span data-ttu-id="5ec2c-166">Ogni metodo presenta uno o due unit test nell'applicazione di test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-166">Each method has one or two unit tests in the test app.</span></span>

| <span data-ttu-id="5ec2c-167">Metodo DAL</span><span class="sxs-lookup"><span data-stu-id="5ec2c-167">DAL method</span></span>               | <span data-ttu-id="5ec2c-168">Funzione</span><span class="sxs-lookup"><span data-stu-id="5ec2c-168">Function</span></span>                                                                   |
| ------------------------ | -------------------------------------------------------------------------- |
| `GetMessagesAsync`       | <span data-ttu-id="5ec2c-169">Ottiene un `List<Message>` dal database vengono ordinato i `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-169">Obtains a `List<Message>` from the database sorted by the `Text` property.</span></span> |
| `AddMessageAsync`        | <span data-ttu-id="5ec2c-170">Aggiunge un `Message` al database.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-170">Adds a `Message` to the database.</span></span>                                          |
| `DeleteAllMessagesAsync` | <span data-ttu-id="5ec2c-171">Elimina tutti `Message` voci dal database.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-171">Deletes all `Message` entries from the database.</span></span>                           |
| `DeleteMessageAsync`     | <span data-ttu-id="5ec2c-172">Elimina una singola `Message` dal database tramite `Id`.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-172">Deletes a single `Message` from the database by `Id`.</span></span>                      |

<span data-ttu-id="5ec2c-173">Unit test del valore DAL richiedono [DbContextOptions](/dotnet/api/microsoft.entityframeworkcore.dbcontextoptions) quando si crea un nuovo `AppDbContext` per ogni test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-173">Unit tests of the DAL require [DbContextOptions](/dotnet/api/microsoft.entityframeworkcore.dbcontextoptions) when creating a new `AppDbContext` for each test.</span></span> <span data-ttu-id="5ec2c-174">Un approccio alla creazione di `DbContextOptions` per ogni test è possibile utilizzare un [DbContextOptionsBuilder](/dotnet/api/microsoft.entityframeworkcore.dbcontextoptionsbuilder):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-174">One approach to creating the `DbContextOptions` for each test is to use a [DbContextOptionsBuilder](/dotnet/api/microsoft.entityframeworkcore.dbcontextoptionsbuilder):</span></span>

```csharp
var optionsBuilder = new DbContextOptionsBuilder<AppDbContext>()
    .UseInMemoryDatabase("InMemoryDb");

using (var db = new AppDbContext(optionsBuilder.Options))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="5ec2c-175">Il problema con questo approccio è che ogni test riceve il database in qualsiasi stato test precedente ha lasciato.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-175">The problem with this approach is that each test receives the database in whatever state the previous test left it.</span></span> <span data-ttu-id="5ec2c-176">Può essere problematico durante la scrittura atomica di unit test che non interferiscano tra loro.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-176">This can be problematic when trying to write atomic unit tests that don't interfere with each other.</span></span> <span data-ttu-id="5ec2c-177">Per forzare il `AppDbContext` per utilizzare un nuovo contesto di database per ogni test, fornire un `DbContextOptions` istanza basata su un nuovo provider del servizio.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-177">To force the `AppDbContext` to use a new database context for each test, supply a `DbContextOptions` instance that's based on a new service provider.</span></span> <span data-ttu-id="5ec2c-178">L'app di test viene illustrato come eseguire questa operazione usando il relativo `Utilities` metodo della classe `TestingDbContextOptions` (*tests/RazorPagesTestingSample.Tests/Utilities/Utilities.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-178">The test app shows how to do this using its `Utilities` class method `TestingDbContextOptions` (*tests/RazorPagesTestingSample.Tests/Utilities/Utilities.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/Utilities/Utilities.cs?name=snippet1)]

<span data-ttu-id="5ec2c-179">Utilizzo di `DbContextOptions` nell'unità di DAL test consente a ogni test da eseguire in modo atomico con un un'istanza aggiornata del database:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-179">Using the `DbContextOptions` in the DAL unit tests allows each test to run atomically with a a fresh database instance:</span></span>

```csharp
using (var db = new AppDbContext(Utilities.TestingDbContextOptions()))
{
    // Use the db here in the unit test.
}
```

<span data-ttu-id="5ec2c-180">Ogni metodo di test nel `DataAccessLayerTest` classe (*UnitTests/DataAccessLayerTest.cs*) segue uno schema analogo Arrange-Act-Assert:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-180">Each test method in the `DataAccessLayerTest` class (*UnitTests/DataAccessLayerTest.cs*) follows a similar Arrange-Act-Assert pattern:</span></span>

1. <span data-ttu-id="5ec2c-181">Disponi: Il database è configurato per il test e/o il risultato previsto è definito.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-181">Arrange: The database is configured for the test and/or the expected outcome is defined.</span></span>
1. <span data-ttu-id="5ec2c-182">ACT: Viene eseguito il test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-182">Act: The test is executed.</span></span>
1. <span data-ttu-id="5ec2c-183">Asserzione: Asserzioni vengono effettuate per determinare se il risultato del test viene eseguita correttamente.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-183">Assert: Assertions are made to determine if the test result is a success.</span></span>

<span data-ttu-id="5ec2c-184">Ad esempio, il `DeleteMessageAsync` metodo è responsabile della rimozione di un singolo messaggio identificato dal relativo `Id` (*src/RazorPagesTestingSample/Data/AppDbContext.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-184">For example, the `DeleteMessageAsync` method is responsible for removing a single message identified by its `Id` (*src/RazorPagesTestingSample/Data/AppDbContext.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/src/RazorPagesTestingSample/Data/AppDbContext.cs?name=snippet4)]

<span data-ttu-id="5ec2c-185">Esistono due test per questo metodo.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-185">There are two tests for this method.</span></span> <span data-ttu-id="5ec2c-186">Un test di verifica che il metodo elimina un messaggio quando il messaggio è presente nel database.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-186">One test checks that the method deletes a message when the message is present in the database.</span></span> <span data-ttu-id="5ec2c-187">Gli altri test di metodo che il database non cambia se il messaggio `Id` per l'eliminazione non esiste.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-187">The other method tests that the database doesn't change if the message `Id` for deletion doesn't exist.</span></span> <span data-ttu-id="5ec2c-188">Il `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` metodo è illustrato di seguito:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-188">The `DeleteMessageAsync_MessageIsDeleted_WhenMessageIsFound` method is shown below:</span></span>

[!code-csharp[Main](razor-pages-testing/sample_snapshot/tests/RazorPagesTestingSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="5ec2c-189">In primo luogo, il metodo esegue il passaggio di disposizione, in cui avviene la preparazione per il passaggio di Act.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-189">First, the method performs the Arrange step, where preparation for the Act step takes place.</span></span> <span data-ttu-id="5ec2c-190">I messaggi di seeding vengono ottenuti e contenuti in `seedMessages`.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-190">The seeding messages are obtained and held in `seedMessages`.</span></span> <span data-ttu-id="5ec2c-191">I messaggi di seeding vengono salvati nel database.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-191">The seeding messages are saved into the database.</span></span> <span data-ttu-id="5ec2c-192">Il messaggio con un `Id` di `1` è impostato per l'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-192">The message with an `Id` of `1` is set for deletion.</span></span> <span data-ttu-id="5ec2c-193">Quando il `DeleteMessageAsync` metodo viene eseguito, dei messaggi previsti devono avere tutti i messaggi, ad eccezione di quello con un `Id` di `1`.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-193">When the `DeleteMessageAsync` method is executed, the expected messages should have all of the messages except for the one with an `Id` of `1`.</span></span> <span data-ttu-id="5ec2c-194">Il `expectedMessages` variabile rappresenta il risultato previsto.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-194">The `expectedMessages` variable represents this expected outcome.</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet1)]

<span data-ttu-id="5ec2c-195">Il metodo agisce: il `DeleteMessageAsync` metodo viene eseguito passando il `recId` di `1`:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-195">The method acts: The `DeleteMessageAsync` method is executed passing in the `recId` of `1`:</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet2)]

<span data-ttu-id="5ec2c-196">Infine, il metodo ottiene il `Messages` dal contesto e confrontato con il `expectedMessages` asserzione che sono uguali:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-196">Finally, the method obtains the `Messages` from the context and compares it to the `expectedMessages` asserting that the two are equal:</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet3)]

<span data-ttu-id="5ec2c-197">Per confrontare che i due `List<Message>` sono gli stessi:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-197">In order to compare that the two `List<Message>` are the same:</span></span>

* <span data-ttu-id="5ec2c-198">I messaggi vengono ordinati in base `Id`.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-198">The messages are ordered by `Id`.</span></span>
* <span data-ttu-id="5ec2c-199">Coppie di messaggi vengono confrontate nel `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-199">Message pairs are compared on the `Text` property.</span></span>

<span data-ttu-id="5ec2c-200">Un metodo di test simile, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` controlla il risultato del tentativo di eliminare un messaggio che non esiste.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-200">A similar test method, `DeleteMessageAsync_NoMessageIsDeleted_WhenMessageIsNotFound` checks the result of attempting to delete a message that doesn't exist.</span></span> <span data-ttu-id="5ec2c-201">In questo caso, i messaggi previsti nel database devono essere uguali per i messaggi effettivi dopo il `DeleteMessageAsync` metodo viene eseguito.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-201">In this case, the expected messages in the database should be equal to the actual messages after the `DeleteMessageAsync` method is executed.</span></span> <span data-ttu-id="5ec2c-202">Non deve esistere alcuna modifica al contenuto del database:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-202">There should be no change to the database's content:</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/UnitTests/DataAccessLayerTest.cs?name=snippet4)]

## <a name="unit-testing-the-page-model-methods"></a><span data-ttu-id="5ec2c-203">Unit test i metodi del modello di pagina</span><span class="sxs-lookup"><span data-stu-id="5ec2c-203">Unit testing the page model methods</span></span>

<span data-ttu-id="5ec2c-204">Un altro set di unit test è responsabile per il test di metodi del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-204">Another set of unit tests is responsible for testing page model methods.</span></span> <span data-ttu-id="5ec2c-205">Nell'applicazione di messaggio, i modelli di pagina di indice, vedere il `IndexModel` classe *src/RazorPagesTestingSample/Pages/Index.cshtml.cs*.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-205">In the message app, the Index page models are found in the `IndexModel` class in *src/RazorPagesTestingSample/Pages/Index.cshtml.cs*.</span></span>

| <span data-ttu-id="5ec2c-206">Metodo del modello di pagina</span><span class="sxs-lookup"><span data-stu-id="5ec2c-206">Page model method</span></span> | <span data-ttu-id="5ec2c-207">Funzione</span><span class="sxs-lookup"><span data-stu-id="5ec2c-207">Function</span></span> |
| ----------------- | -------- | 
| `OnGetAsync` | <span data-ttu-id="5ec2c-208">Ottiene i messaggi per l'interfaccia utente utilizzando il `GetMessagesAsync` metodo.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-208">Obtains the messages from the DAL for the UI using the `GetMessagesAsync` method.</span></span> |
| `OnPostAddMessageAsync` | <span data-ttu-id="5ec2c-209">Se il `ModelState` è valido, le chiamate `AddMessageAsync` per aggiungere un messaggio al database.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-209">If the `ModelState` is valid, calls `AddMessageAsync` to add a message to the database.</span></span> | 
| `OnPostDeleteAllMessagesAsync` | <span data-ttu-id="5ec2c-210">Chiamate `DeleteAllMessagesAsync` per eliminare tutti i messaggi nel database.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-210">Calls `DeleteAllMessagesAsync` to delete all of the messages in the database.</span></span> |
| `OnPostDeleteMessageAsync` | <span data-ttu-id="5ec2c-211">Esegue `DeleteMessageAsync` per eliminare un messaggio con il `Id` specificato.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-211">Executes `DeleteMessageAsync` to delete a message with the `Id` specified.</span></span> |
| `OnPostAnalyzeMessagesAsync` | <span data-ttu-id="5ec2c-212">Se uno o più messaggi nel database, calcola il numero medio di parole per ogni messaggio.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-212">If one or more messages are in the database, calculates the average number of words per message.</span></span> |

<span data-ttu-id="5ec2c-213">I metodi del modello di pagina vengono testati utilizzando sette test il `IndexPageTest` classe (*tests/RazorPagesTestingSample.Tests/UnitTests/IndexPageTest.cs*).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-213">The page model methods are tested using seven tests in the `IndexPageTest` class (*tests/RazorPagesTestingSample.Tests/UnitTests/IndexPageTest.cs*).</span></span> <span data-ttu-id="5ec2c-214">I test utilizzano il modello di Act Assert Disponi familiarità.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-214">The tests use the familiar Arrange-Assert-Act pattern.</span></span> <span data-ttu-id="5ec2c-215">Questi test sono incentrati su:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-215">These tests focus on:</span></span>

* <span data-ttu-id="5ec2c-216">Determinare se i metodi di seguono il comportamento corretto quando il `ModelState` non è valido.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-216">Determining if the methods follow the correct behavior when the `ModelState` is invalid.</span></span>
* <span data-ttu-id="5ec2c-217">I metodi di conferma produrre corrette `IActionResult`.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-217">Confirming the methods produce the correct `IActionResult`.</span></span>
* <span data-ttu-id="5ec2c-218">Verifica che le assegnazioni dei valori di proprietà vengono effettuate correttamente.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-218">Checking that property value assignments are made correctly.</span></span>

<span data-ttu-id="5ec2c-219">Questo gruppo di test spesso simulare i metodi di per produrre dati previsto per il passaggio di Act, in cui viene eseguito un metodo di modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-219">This group of tests often mock the methods of the DAL to produce expected data for the Act step where a page model method is executed.</span></span> <span data-ttu-id="5ec2c-220">Ad esempio, il `GetMessagesAsync` metodo il `AppDbContext` è esempio per generare un output.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-220">For example, the `GetMessagesAsync` method of the `AppDbContext` is mocked to produce output.</span></span> <span data-ttu-id="5ec2c-221">Quando un metodo di modello di pagina viene eseguito questo metodo, la simulazione restituisce il risultato.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-221">When a page model method executes this method, the mock returns the result.</span></span> <span data-ttu-id="5ec2c-222">I dati non provengono dal database.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-222">The data doesn't come from the database.</span></span> <span data-ttu-id="5ec2c-223">Consente di creare condizioni di test prevedibili e affidabili per l'utilizzo dai test del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-223">This creates predictable, reliable test conditions for using the DAL in the page model tests.</span></span>

<span data-ttu-id="5ec2c-224">Il `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test Mostra come `GetMessagesAsync` metodo è esempio per il modello di pagina:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-224">The `OnGetAsync_PopulatesThePageModel_WithAListOfMessages` test shows how the `GetMessagesAsync` method is mocked for the page model:</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/UnitTests/IndexPageTest.cs?name=snippet1&highlight=3-4)]

<span data-ttu-id="5ec2c-225">Quando il `OnGetAsync` metodo viene eseguito nel passaggio Act, chiama il modello di pagina `GetMessagesAsync` metodo.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-225">When the `OnGetAsync` method is executed in the Act step, it calls the page model's `GetMessagesAsync` method.</span></span>

<span data-ttu-id="5ec2c-226">Passaggio di Act di unit test (*tests/RazorPagesTestingSample.Tests/UnitTests/IndexPageTest.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-226">Unit test Act step (*tests/RazorPagesTestingSample.Tests/UnitTests/IndexPageTest.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/UnitTests/IndexPageTest.cs?name=snippet2)]

<span data-ttu-id="5ec2c-227">`IndexPage`modello di pagina `OnGetAsync` metodo (*src/RazorPagesTestingSample/Pages/Index.cshtml.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-227">`IndexPage` page model's `OnGetAsync` method (*src/RazorPagesTestingSample/Pages/Index.cshtml.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/src/RazorPagesTestingSample/Pages/Index.cshtml.cs?name=snippet1&highlight=3)]

<span data-ttu-id="5ec2c-228">Il `GetMessagesAsync` DAL metodo non restituisce il risultato per questa chiamata al metodo.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-228">The `GetMessagesAsync` method in the DAL doesn't return the result for this method call.</span></span> <span data-ttu-id="5ec2c-229">La versione del metodo simulata restituisce il risultato.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-229">The mocked version of the method returns the result.</span></span>

<span data-ttu-id="5ec2c-230">Nel `Assert` passaggio, i messaggi effettivi (`actualMessages`) vengono assegnati dal `Messages` proprietà del modello di pagina.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-230">In the `Assert` step, the actual messages (`actualMessages`) are assigned from the `Messages` property of the page model.</span></span> <span data-ttu-id="5ec2c-231">Un controllo del tipo viene eseguito anche quando vengono assegnati i messaggi.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-231">A type check is also performed when the messages are assigned.</span></span> <span data-ttu-id="5ec2c-232">I messaggi previsti ed effettivi vengono confrontati per loro `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-232">The expected and actual messages are compared by their `Text` properties.</span></span> <span data-ttu-id="5ec2c-233">Il test asserisce che i due `List<Message>` istanze contengono gli stessi messaggi.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-233">The test asserts that the two `List<Message>` instances contain the same messages.</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/UnitTests/IndexPageTest.cs?name=snippet3)]

<span data-ttu-id="5ec2c-234">Altri test in questo gruppo di creare pagina di oggetti modello che includono il `DefaultHttpContext`, `ModelStateDictionary`, un `ActionContext` per stabilire il `PageContext`, un `ViewDataDictionary`e un `PageContext`.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-234">Other tests in this group create page model objects that include the `DefaultHttpContext`, the `ModelStateDictionary`, an `ActionContext` to establish the `PageContext`, a `ViewDataDictionary`, and a `PageContext`.</span></span> <span data-ttu-id="5ec2c-235">Questi sono utili per l'esecuzione di test.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-235">These are useful in conducting tests.</span></span> <span data-ttu-id="5ec2c-236">Ad esempio, l'app messaggio stabilisce un `ModelState` errore con `AddModelError` per verificare che un oggetto valido `PageResult` viene restituito quando `OnPostAddMessageAsync` viene eseguita:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-236">For example, the message app establishes a `ModelState` error with `AddModelError` to check that a valid `PageResult` is returned when `OnPostAddMessageAsync` is executed:</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/UnitTests/IndexPageTest.cs?name=snippet4&highlight=11,26,29,32)]

## <a name="integration-testing-the-app"></a><span data-ttu-id="5ec2c-237">L'app di test di integrazione</span><span class="sxs-lookup"><span data-stu-id="5ec2c-237">Integration testing the app</span></span>

<span data-ttu-id="5ec2c-238">L'integrazione verifica lo stato attivo sul test che interagiscono componenti dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-238">The integration tests focus on testing that the app's components work together.</span></span> <span data-ttu-id="5ec2c-239">Test di integrazione vengono effettuate con il [Host di Test ASP.NET Core](xref:testing/integration-testing#the-test-host).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-239">Integration tests are conducted using the [ASP.NET Core Test Host](xref:testing/integration-testing#the-test-host).</span></span> <span data-ttu-id="5ec2c-240">È possibile testare l'elaborazione del ciclo di vita completo di richiesta-risposta.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-240">Full request-response lifecycle processing is tested.</span></span> <span data-ttu-id="5ec2c-241">Questi test asserire che la pagina genera il codice di stato corretto e `Location` intestazione, se impostata.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-241">These tests assert that the page produces the correct status code and `Location` header, if set.</span></span>

<span data-ttu-id="5ec2c-242">Un esempio tratto dall'esempio di test di integrazione controlla il risultato della richiesta della pagina di indice dell'app messaggio (*tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-242">An integration testing example from the sample checks the result of requesting the Index page of the message app (*tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs?name=snippet1)]

<span data-ttu-id="5ec2c-243">Non vi è alcun passaggio di disposizione.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-243">There's no Arrange step.</span></span> <span data-ttu-id="5ec2c-244">Il `GetAsync` metodo viene chiamato sul `HttpClient` per inviare una richiesta GET all'endpoint.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-244">The `GetAsync` method is called on the `HttpClient` to send a GET request to the endpoint.</span></span> <span data-ttu-id="5ec2c-245">Il test indica che il risultato è un codice di stato 200 OK.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-245">The test asserts that the result is a 200-OK status code.</span></span>

<span data-ttu-id="5ec2c-246">Qualsiasi richiesta POST per l'app del messaggio deve soddisfare il controllo non riproducibili automaticamente effettuato tramite l'app [sistema di protezione dei dati non riproducibili](xref:security/data-protection/introduction).</span><span class="sxs-lookup"><span data-stu-id="5ec2c-246">Any POST request to the message app must satisfy the antiforgery check that's automatically made by the app's [data protection antiforgery system](xref:security/data-protection/introduction).</span></span> <span data-ttu-id="5ec2c-247">Per disporre di una richiesta POST di un test, è necessario l'app di test:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-247">In order to arrange for a test's POST request, the test app must:</span></span>

1. <span data-ttu-id="5ec2c-248">Effettuare una richiesta per la pagina.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-248">Make a request for the page.</span></span>
1. <span data-ttu-id="5ec2c-249">Analizzare i cookie non riproducibili e un token di convalida richiesta dalla risposta.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-249">Parse the antiforgery cookie and request validation token from the response.</span></span>
1. <span data-ttu-id="5ec2c-250">Eseguire la richiesta POST con la convalida non riproducibili cookie e richiesta di token sul posto.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-250">Make the POST request with the antiforgery cookie and request validation token in place.</span></span>

<span data-ttu-id="5ec2c-251">Il `Post_AddMessageHandler_ReturnsRedirectToRoot` metodo di test:</span><span class="sxs-lookup"><span data-stu-id="5ec2c-251">The `Post_AddMessageHandler_ReturnsRedirectToRoot` test method:</span></span>

* <span data-ttu-id="5ec2c-252">Prepara un messaggio e `HttpClient`.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-252">Prepares a message and the `HttpClient`.</span></span>
* <span data-ttu-id="5ec2c-253">Effettua una richiesta POST all'app.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-253">Makes a POST request to the app.</span></span>
* <span data-ttu-id="5ec2c-254">Controlla che la risposta è un reindirizzamento alla pagina di indice.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-254">Checks the response is a redirect back to the Index page.</span></span>

<span data-ttu-id="5ec2c-255">`Post_AddMessageHandler_ReturnsRedirectToRoot `metodo (*tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-255">`Post_AddMessageHandler_ReturnsRedirectToRoot ` method (*tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs?name=snippet2)]

<span data-ttu-id="5ec2c-256">Il `GetRequestContentAsync` metodo di utilità gestisce preparazione del client con il cookie non riproducibili e token di richiesta di verifica.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-256">The `GetRequestContentAsync` utility method manages preparing the client with the antiforgery cookie and request verification token.</span></span> <span data-ttu-id="5ec2c-257">Si noti come il metodo riceve un `IDictionary` che consente di passare i dati per la richiesta per la codifica con il token di richiesta di verifica la chiamata al metodo di test (*tests/RazorPagesTestingSample.Tests/Utilities/Utilities.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-257">Note how the method receives an `IDictionary` that permits the calling test method to pass in data for the request to encode along with the request verification token (*tests/RazorPagesTestingSample.Tests/Utilities/Utilities.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/Utilities/Utilities.cs?name=snippet2&highlight=1-2,8-9,29)]

<span data-ttu-id="5ec2c-258">Test di integrazione dati errati possono anche passare all'app per testare il comportamento di risposta dell'app.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-258">Integration tests can also pass bad data to the app to test the app's response behavior.</span></span> <span data-ttu-id="5ec2c-259">L'app messaggio limita la lunghezza del messaggio a 200 caratteri (*src/RazorPagesTestingSample/Data/Message.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-259">The message app limits message length to 200 characters (*src/RazorPagesTestingSample/Data/Message.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/src/RazorPagesTestingSample/Data/Message.cs?name=snippet1&highlight=7)]

<span data-ttu-id="5ec2c-260">Il `Post_AddMessageHandler_ReturnsSuccess_WhenMessageTextTooLong` test `Message` passa in modo esplicito come testo con caratteri "X" 201.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-260">The `Post_AddMessageHandler_ReturnsSuccess_WhenMessageTextTooLong` test `Message` explicitly passes in text with 201 "X" characters.</span></span> <span data-ttu-id="5ec2c-261">Ciò comporta un `ModelState` errore.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-261">This results in a `ModelState` error.</span></span> <span data-ttu-id="5ec2c-262">Il POST non reindirizza alla pagina di indice.</span><span class="sxs-lookup"><span data-stu-id="5ec2c-262">The POST doesn't redirect back to the Index page.</span></span> <span data-ttu-id="5ec2c-263">Restituisce un 200 OK con un `null` `Location` intestazione (*tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs*):</span><span class="sxs-lookup"><span data-stu-id="5ec2c-263">It returns a 200-OK with a `null` `Location` header (*tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs*):</span></span>

[!code-csharp[Main](razor-pages-testing/sample/tests/RazorPagesTestingSample.Tests/IntegrationTests/IndexPageTest.cs?name=snippet3&highlight=7,16-17)]

## <a name="see-also"></a><span data-ttu-id="5ec2c-264">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="5ec2c-264">See also</span></span>

* [<span data-ttu-id="5ec2c-265">Unit test c# in .NET Core usando xUnit e test dotnet</span><span class="sxs-lookup"><span data-stu-id="5ec2c-265">Unit testing C# in .NET Core using dotnet test and xUnit</span></span>](/dotnet/articles/core/testing/unit-testing-with-dotnet-test)
* [<span data-ttu-id="5ec2c-266">Test di integrazione</span><span class="sxs-lookup"><span data-stu-id="5ec2c-266">Integration testing</span></span>](xref:testing/integration-testing)
* [<span data-ttu-id="5ec2c-267">Test dei controller</span><span class="sxs-lookup"><span data-stu-id="5ec2c-267">Testing controllers</span></span>](xref:mvc/controllers/testing)
* <span data-ttu-id="5ec2c-268">[Il codice dello unit Test](/visualstudio/test/unit-test-your-code) (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="5ec2c-268">[Unit Test Your Code](/visualstudio/test/unit-test-your-code) (Visual Studio)</span></span>
* [<span data-ttu-id="5ec2c-269">xUnit.net</span><span class="sxs-lookup"><span data-stu-id="5ec2c-269">xUnit.net</span></span>](https://xunit.github.io/)
* [<span data-ttu-id="5ec2c-270">Introduzione a xUnit.net (.NET Core/ASP.NET Core)</span><span class="sxs-lookup"><span data-stu-id="5ec2c-270">Getting started with xUnit.net (.NET Core/ASP.NET Core)</span></span>](https://xunit.github.io/docs/getting-started-dotnet-core)
* [<span data-ttu-id="5ec2c-271">Moq</span><span class="sxs-lookup"><span data-stu-id="5ec2c-271">Moq</span></span>](https://github.com/moq/moq4)
* [<span data-ttu-id="5ec2c-272">Guida introduttiva Moq</span><span class="sxs-lookup"><span data-stu-id="5ec2c-272">Moq Quickstart</span></span>](https://github.com/Moq/moq4/wiki/Quickstart)
