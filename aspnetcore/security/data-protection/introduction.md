---
title: Protezione dei dati di ASP.NET Core
author: rick-anderson
description: Scopri il concetto di protezione dei dati e i principi di progettazione di ASP.NET Core Data Protection API.
ms.author: riande
ms.date: 10/14/2016
uid: security/data-protection/introduction
ms.openlocfilehash: 29a2bbef6f2fd9b61541173af143926ca82bfad7
ms.sourcegitcommit: 3ca527f27c88cfc9d04688db5499e372fbc2c775
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/17/2018
ms.locfileid: "39095695"
---
# <a name="aspnet-core-data-protection"></a><span data-ttu-id="f23bc-103">Protezione dei dati di ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="f23bc-103">ASP.NET Core Data Protection</span></span>

<span data-ttu-id="f23bc-104">Le applicazioni Web è spesso necessario archiviare i dati sensibili alla sicurezza.</span><span class="sxs-lookup"><span data-stu-id="f23bc-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="f23bc-105">Windows fornisce DPAPI per le applicazioni desktop, ma ciò non è adatta per le applicazioni web.</span><span class="sxs-lookup"><span data-stu-id="f23bc-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="f23bc-106">Lo stack di protezione dei dati di ASP.NET Core forniscono un'API di crittografia semplice e facile da usare uno sviluppatore può utilizzare per proteggere i dati, tra cui la rotazione e la gestione delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="f23bc-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="f23bc-107">Lo stack di protezione dei dati di ASP.NET Core è progettato per essere utilizzato come valore di sostituzione a lungo termine per il &lt;machineKey&gt; elemento in ASP.NET 1.x - 4.x.</span><span class="sxs-lookup"><span data-stu-id="f23bc-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the &lt;machineKey&gt; element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="f23bc-108">È stato progettato per soddisfare molte delle carenze del vecchio stack di crittografia, offrendo una soluzione di out-of-the-box per la maggior parte dei casi d'uso di applicazioni moderne possono incontrare.</span><span class="sxs-lookup"><span data-stu-id="f23bc-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="f23bc-109">Presentazione del problema</span><span class="sxs-lookup"><span data-stu-id="f23bc-109">Problem statement</span></span>

<span data-ttu-id="f23bc-110">L'istruzione di problema generale può essere dichiarata in una singola frase sinteticamente: è necessario rendere persistenti le informazioni attendibili per un successivo recupero, ma il meccanismo di persistenza non attendibili.</span><span class="sxs-lookup"><span data-stu-id="f23bc-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="f23bc-111">In termini di web, questo potrebbe essere scritto come "Ho bisogno di andata e ritorno dello stato attendibile tramite un client non attendibile".</span><span class="sxs-lookup"><span data-stu-id="f23bc-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="f23bc-112">L'esempio canonico è un cookie di autenticazione o bearer token.</span><span class="sxs-lookup"><span data-stu-id="f23bc-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="f23bc-113">Il server genera un "Sono Groot e disporre delle autorizzazioni xyz" del token e lo passa al client.</span><span class="sxs-lookup"><span data-stu-id="f23bc-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="f23bc-114">Successivamente il client presenta tale token al server, ma il server deve avere un tipo di garanzia che il client non è ancora contraffatto il token.</span><span class="sxs-lookup"><span data-stu-id="f23bc-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="f23bc-115">In questo modo il primo requisito: autenticità (noto anche come</span><span class="sxs-lookup"><span data-stu-id="f23bc-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="f23bc-116">l'integrità, a prova di manomissione).</span><span class="sxs-lookup"><span data-stu-id="f23bc-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="f23bc-117">Poiché lo stato persistente è considerato attendibile dal server, si prevede che questo stato può contenere informazioni specifiche per l'ambiente operativo.</span><span class="sxs-lookup"><span data-stu-id="f23bc-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="f23bc-118">Ciò potrebbe essere in forma di un percorso di file, un'autorizzazione, un handle o altri riferimento indiretto o altre parti di dati specifici del server.</span><span class="sxs-lookup"><span data-stu-id="f23bc-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="f23bc-119">Tali informazioni a livello generale non devono essere rivelate a un client non attendibile.</span><span class="sxs-lookup"><span data-stu-id="f23bc-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="f23bc-120">In questo modo il secondo requisito: riservatezza.</span><span class="sxs-lookup"><span data-stu-id="f23bc-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="f23bc-121">Infine, poiché vengano suddivisa in componenti di applicazioni moderne, ciò che abbiamo visto è che i singoli componenti desidera sfruttare i vantaggi di questo sistema indipendentemente da altri componenti nel sistema.</span><span class="sxs-lookup"><span data-stu-id="f23bc-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="f23bc-122">Ad esempio, se un componente di bearer token Usa lo stack, dovrebbe funzionare senza interferenze da un meccanismo di anti-CSRF che potrebbe anche usare lo stesso stack.</span><span class="sxs-lookup"><span data-stu-id="f23bc-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="f23bc-123">In questo modo l'ultimo requisito: isolamento.</span><span class="sxs-lookup"><span data-stu-id="f23bc-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="f23bc-124">Possiamo fornire ulteriormente i vincoli per limitare l'ambito dei requisiti.</span><span class="sxs-lookup"><span data-stu-id="f23bc-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="f23bc-125">Si presuppone che tutti i servizi che operano all'interno di sistema di crittografia sono altrettanto attendibili e che i dati non devono essere generato o utilizzato di fuori di servizi sotto il controllo diretto.</span><span class="sxs-lookup"><span data-stu-id="f23bc-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="f23bc-126">Inoltre, è necessario che le operazioni sono nel minor tempo poiché ogni richiesta al servizio web può passare attraverso il sistema di crittografia una o più volte.</span><span class="sxs-lookup"><span data-stu-id="f23bc-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="f23bc-127">Ciò rende ideale per questo scenario la crittografia simmetrica e crittografia asimmetrica viene possibile discount fino ad una volta che è necessario.</span><span class="sxs-lookup"><span data-stu-id="f23bc-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="f23bc-128">Filosofia di progettazione</span><span class="sxs-lookup"><span data-stu-id="f23bc-128">Design philosophy</span></span>

<span data-ttu-id="f23bc-129">Iniziammo identificando i problemi con lo stack di esistente.</span><span class="sxs-lookup"><span data-stu-id="f23bc-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="f23bc-130">Una volta che avevamo, abbiamo intervistati ha dichiarato il panorama delle soluzioni esistenti e conclude che nessuna soluzione era piuttosto le funzionalità di cui che viene ricercati.</span><span class="sxs-lookup"><span data-stu-id="f23bc-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="f23bc-131">Quindi, abbiamo progettato una soluzione basata su alcuni principi guida.</span><span class="sxs-lookup"><span data-stu-id="f23bc-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="f23bc-132">Il sistema deve offrire semplicità di configurazione.</span><span class="sxs-lookup"><span data-stu-id="f23bc-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="f23bc-133">Idealmente, il sistema sarebbe senza operazioni di configurazione e gli sviluppatori è stato possibile inizia subito.</span><span class="sxs-lookup"><span data-stu-id="f23bc-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="f23bc-134">Situazioni in cui gli sviluppatori devono configurare un aspetto specifico (ad esempio l'archivio chiave), debba essere presi in considerazione rendendo semplice tali configurazioni specifiche.</span><span class="sxs-lookup"><span data-stu-id="f23bc-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="f23bc-135">Offrono una semplice API per consumatori.</span><span class="sxs-lookup"><span data-stu-id="f23bc-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="f23bc-136">Le API devono essere facile da utilizzare in modo corretto e difficile da usare in modo non corretto.</span><span class="sxs-lookup"><span data-stu-id="f23bc-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="f23bc-137">Gli sviluppatori non devono illustrato i principi di gestione delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="f23bc-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="f23bc-138">Il sistema deve gestire la durata di chiave per conto dello sviluppatore e selezione dell'algoritmo.</span><span class="sxs-lookup"><span data-stu-id="f23bc-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="f23bc-139">In teoria lo sviluppatore non è nemmeno avrà accesso al materiale della chiave non elaborato.</span><span class="sxs-lookup"><span data-stu-id="f23bc-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="f23bc-140">Le chiavi devono essere protette quando sono inattivi quando possibile.</span><span class="sxs-lookup"><span data-stu-id="f23bc-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="f23bc-141">Il sistema deve stabilire un meccanismo di protezione predefinito appropriato e lo applica automaticamente.</span><span class="sxs-lookup"><span data-stu-id="f23bc-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="f23bc-142">Con questi principi mente abbiamo sviluppato una semplice [facile da usare](xref:security/data-protection/using-data-protection) lo stack di protezione dati.</span><span class="sxs-lookup"><span data-stu-id="f23bc-142">With these principles in mind we developed a simple, [easy to use](xref:security/data-protection/using-data-protection) data protection stack.</span></span>

<span data-ttu-id="f23bc-143">Le API di protezione dati ASP.NET Core non sono principalmente destinati indefinita persistenza del payload riservati.</span><span class="sxs-lookup"><span data-stu-id="f23bc-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="f23bc-144">Come altre tecnologie [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) e [Azure Rights Management](https://docs.microsoft.com/rights-management/) sono più adatte allo scenario di archiviazione illimitata, e hanno le funzionalità di gestione delle chiavi sicuro o ridotta di conseguenza.</span><span class="sxs-lookup"><span data-stu-id="f23bc-144">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](https://docs.microsoft.com/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="f23bc-145">Ciò premesso, non c'è niente divieto di uno sviluppatore di usare le API di protezione dati ASP.NET Core per la protezione a lungo termine dei dati riservati.</span><span class="sxs-lookup"><span data-stu-id="f23bc-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="f23bc-146">Destinatari</span><span class="sxs-lookup"><span data-stu-id="f23bc-146">Audience</span></span>

<span data-ttu-id="f23bc-147">Il sistema di protezione dati è suddivisa in cinque pacchetti principali.</span><span class="sxs-lookup"><span data-stu-id="f23bc-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="f23bc-148">Tre gruppi di destinatari principali; di destinazione di vari aspetti di queste API</span><span class="sxs-lookup"><span data-stu-id="f23bc-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="f23bc-149">Il [panoramica delle API Consumer](xref:security/data-protection/consumer-apis/overview) agli sviluppatori di applicazioni e framework di destinazione.</span><span class="sxs-lookup"><span data-stu-id="f23bc-149">The [Consumer APIs Overview](xref:security/data-protection/consumer-apis/overview) target application and framework developers.</span></span>

   <span data-ttu-id="f23bc-150">"Non desidero informazioni sulle modalità di funzionamento dello stack o sulla relativa configurazione.</span><span class="sxs-lookup"><span data-stu-id="f23bc-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="f23bc-151">Desidera semplicemente eseguire alcune operazioni in più semplice modo possibili con probabilità elevata usando le API è stata."</span><span class="sxs-lookup"><span data-stu-id="f23bc-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="f23bc-152">Il [API di configurazione](xref:security/data-protection/configuration/overview) agli sviluppatori di applicazioni e amministratori di sistema di destinazione.</span><span class="sxs-lookup"><span data-stu-id="f23bc-152">The [configuration APIs](xref:security/data-protection/configuration/overview) target application developers and system administrators.</span></span>

   <span data-ttu-id="f23bc-153">"È necessario indicare al sistema di protezione dati che l'ambiente richiede impostazioni o i percorsi non predefiniti."</span><span class="sxs-lookup"><span data-stu-id="f23bc-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="f23bc-154">Gli sviluppatori di destinazione le API estendibilità responsabile dell'implementazione di criteri personalizzato.</span><span class="sxs-lookup"><span data-stu-id="f23bc-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="f23bc-155">Utilizzo di queste API limitata a situazioni rare ed esperti, gli sviluppatori con riconoscimento della protezione.</span><span class="sxs-lookup"><span data-stu-id="f23bc-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="f23bc-156">"È necessario sostituire un intero componente all'interno del sistema perché ho requisiti comportamentali davvero unico.</span><span class="sxs-lookup"><span data-stu-id="f23bc-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="f23bc-157">Accetto di altre parti usato insolito della superficie dell'API per creare un plug-in che soddisfa i requisiti."</span><span class="sxs-lookup"><span data-stu-id="f23bc-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="f23bc-158">Layout pacchetto</span><span class="sxs-lookup"><span data-stu-id="f23bc-158">Package Layout</span></span>

<span data-ttu-id="f23bc-159">Lo stack di protezione dati è costituito da cinque pacchetti.</span><span class="sxs-lookup"><span data-stu-id="f23bc-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="f23bc-160">Microsoft.AspNetCore.DataProtection.Abstractions contiene le interfacce IDataProtectionProvider e oggetto IDataProtector base.</span><span class="sxs-lookup"><span data-stu-id="f23bc-160">Microsoft.AspNetCore.DataProtection.Abstractions contains the basic IDataProtectionProvider and IDataProtector interfaces.</span></span> <span data-ttu-id="f23bc-161">Include anche i metodi di estensione utili che possono agevolare l'utilizzo di questi tipi (ad esempio, gli overload di IDataProtector.Protect).</span><span class="sxs-lookup"><span data-stu-id="f23bc-161">It also contains useful extension methods that can assist working with these types (e.g., overloads of IDataProtector.Protect).</span></span> <span data-ttu-id="f23bc-162">Vedere la sezione di interfacce utente per altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="f23bc-162">See the consumer interfaces section for more information.</span></span> <span data-ttu-id="f23bc-163">Se un altro utente è responsabile della creazione di un'istanza nel sistema di protezione dei dati e si stanno semplicemente utilizzando le API, è opportuno riferimento Microsoft.AspNetCore.DataProtection.Abstractions.</span><span class="sxs-lookup"><span data-stu-id="f23bc-163">If somebody else is responsible for instantiating the data protection system and you are simply consuming the APIs, you'll want to reference Microsoft.AspNetCore.DataProtection.Abstractions.</span></span>

* <span data-ttu-id="f23bc-164">Microsoft.AspNetCore.DataProtection contiene l'implementazione di base del sistema di protezione dati, tra cui le operazioni di crittografia di base, la gestione delle chiavi, configurazione ed estendibilità.</span><span class="sxs-lookup"><span data-stu-id="f23bc-164">Microsoft.AspNetCore.DataProtection contains the core implementation of the data protection system, including the core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="f23bc-165">Se sei responsabile della creazione di un'istanza nel sistema di protezione dei dati (ad esempio, aggiungerlo a un IServiceCollection) oppure modificare o estendere il comportamento, è opportuno riferimento Microsoft.AspNetCore.DataProtection.</span><span class="sxs-lookup"><span data-stu-id="f23bc-165">If you're responsible for instantiating the data protection system (e.g., adding it to an IServiceCollection) or modifying or extending its behavior, you'll want to reference Microsoft.AspNetCore.DataProtection.</span></span>

* <span data-ttu-id="f23bc-166">Microsoft.AspNetCore.DataProtection.Extensions contiene API aggiuntive, quali gli sviluppatori possono risultare utili, ma che non appartengono nel pacchetto di base.</span><span class="sxs-lookup"><span data-stu-id="f23bc-166">Microsoft.AspNetCore.DataProtection.Extensions contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="f23bc-167">Ad esempio, questo pacchetto contiene un'API "creare un'istanza del sistema che punta a una directory di archiviazione delle chiavi specifici senza alcuna impostazione di inserimento delle dipendenze" semplice (ulteriori informazioni).</span><span class="sxs-lookup"><span data-stu-id="f23bc-167">For instance, this package contains a simple "instantiate the system pointing at a specific key storage directory with no dependency injection setup" API (more info).</span></span> <span data-ttu-id="f23bc-168">Include anche i metodi di estensione per la limitazione della durata di payload protetti (ulteriori informazioni).</span><span class="sxs-lookup"><span data-stu-id="f23bc-168">It also contains extension methods for limiting the lifetime of protected payloads (more info).</span></span>

* <span data-ttu-id="f23bc-169">Microsoft.AspNetCore.DataProtection.SystemWeb può essere installato in un'applicazione 4.x ASP.NET esistente per reindirizzare relativi &lt;machineKey&gt; operazioni per usare invece il nuovo stack di protezione dati.</span><span class="sxs-lookup"><span data-stu-id="f23bc-169">Microsoft.AspNetCore.DataProtection.SystemWeb can be installed into an existing ASP.NET 4.x application to redirect its &lt;machineKey&gt; operations to instead use the new data protection stack.</span></span> <span data-ttu-id="f23bc-170">Visualizzare [compatibilità](xref:security/data-protection/compatibility/replacing-machinekey#compatibility-replacing-machinekey) per altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="f23bc-170">See [compatibility](xref:security/data-protection/compatibility/replacing-machinekey#compatibility-replacing-machinekey) for more information.</span></span>

* <span data-ttu-id="f23bc-171">Microsoft.AspNetCore.Cryptography.KeyDerivation fornisce un'implementazione della password PBKDF2 hashing routine e può essere utilizzato da sistemi che devono gestire in modo sicuro le password degli utenti.</span><span class="sxs-lookup"><span data-stu-id="f23bc-171">Microsoft.AspNetCore.Cryptography.KeyDerivation provides an implementation of the PBKDF2 password hashing routine and can be used by systems which need to handle user passwords securely.</span></span> <span data-ttu-id="f23bc-172">Visualizzare [Hash delle password](xref:security/data-protection/consumer-apis/password-hashing) per altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="f23bc-172">See [Hash passwords](xref:security/data-protection/consumer-apis/password-hashing) for more information.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="f23bc-173">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="f23bc-173">Additional resources</span></span>

<xref:host-and-deploy/web-farm>
