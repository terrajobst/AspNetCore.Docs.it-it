---
title: Protezione dei dati ASP.NET Core
author: rick-anderson
description: Informazioni sul concetto di protezione dei dati e sui principi di progettazione delle API di protezione dei dati ASP.NET Core.
ms.author: riande
ms.custom: mvc
ms.date: 10/24/2018
uid: security/data-protection/introduction
ms.openlocfilehash: 37f170a3e8a46ef2215b0999358d46dd402636df
ms.sourcegitcommit: 9a129f5f3e31cc449742b164d5004894bfca90aa
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/06/2020
ms.locfileid: "78664444"
---
# <a name="aspnet-core-data-protection"></a><span data-ttu-id="b171f-103">Protezione dei dati ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="b171f-103">ASP.NET Core Data Protection</span></span>

<span data-ttu-id="b171f-104">Le applicazioni Web spesso devono archiviare dati sensibili alla sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b171f-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="b171f-105">Windows fornisce DPAPI per le applicazioni desktop, ma questo non è adatto per le applicazioni Web.</span><span class="sxs-lookup"><span data-stu-id="b171f-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="b171f-106">Lo stack di protezione dei dati ASP.NET Core fornisce un'API di crittografia semplice e facile da usare che uno sviluppatore può usare per proteggere i dati, tra cui la gestione e la rotazione delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="b171f-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="b171f-107">Lo stack di protezione dei dati ASP.NET Core è progettato per fungere da sostituzione a lungo termine per l'elemento&gt; &lt;machineKey in ASP.NET 1. x-4. x.</span><span class="sxs-lookup"><span data-stu-id="b171f-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the &lt;machineKey&gt; element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="b171f-108">È stato progettato per risolvere molti dei difetti del vecchio stack di crittografia, offrendo al tempo stesso una soluzione predefinita per la maggior parte dei casi d'uso che è probabile che si verifichino le applicazioni moderne.</span><span class="sxs-lookup"><span data-stu-id="b171f-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="b171f-109">Presentazione del problema</span><span class="sxs-lookup"><span data-stu-id="b171f-109">Problem statement</span></span>

<span data-ttu-id="b171f-110">L'informativa sul problema generale può essere concisa in una singola frase: è necessario rendere persistenti le informazioni attendibili per il recupero successivo, ma non si considera attendibile il meccanismo di persistenza.</span><span class="sxs-lookup"><span data-stu-id="b171f-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="b171f-111">In termini Web, questo potrebbe essere scritto come "è necessario eseguire il round trip di stato attendibile tramite un client non attendibile".</span><span class="sxs-lookup"><span data-stu-id="b171f-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="b171f-112">L'esempio canonico è un cookie di autenticazione o bearer token.</span><span class="sxs-lookup"><span data-stu-id="b171f-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="b171f-113">Il server genera un token "I am Groot and have XYZ Permissions" e lo passa al client.</span><span class="sxs-lookup"><span data-stu-id="b171f-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="b171f-114">In una data futura il client presenta il token al server, ma il server richiede un certo tipo di garanzia che il client non abbia falsificato il token.</span><span class="sxs-lookup"><span data-stu-id="b171f-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="b171f-115">Quindi, il primo requisito: autenticità (noto anche come</span><span class="sxs-lookup"><span data-stu-id="b171f-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="b171f-116">integrità, correzione delle manomissioni.</span><span class="sxs-lookup"><span data-stu-id="b171f-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="b171f-117">Poiché lo stato permanente è considerato attendibile dal server, si prevede che questo stato possa contenere informazioni specifiche per l'ambiente operativo.</span><span class="sxs-lookup"><span data-stu-id="b171f-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="b171f-118">Il formato potrebbe essere un percorso di file, un'autorizzazione, un handle o un altro riferimento indiretto o altri dati specifici del server.</span><span class="sxs-lookup"><span data-stu-id="b171f-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="b171f-119">Tali informazioni in genere non devono essere divulgate a un client non attendibile.</span><span class="sxs-lookup"><span data-stu-id="b171f-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="b171f-120">Quindi, il secondo requisito: riservatezza.</span><span class="sxs-lookup"><span data-stu-id="b171f-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="b171f-121">Infine, poiché le applicazioni moderne sono componenti, ciò che abbiamo visto è che i singoli componenti vorranno sfruttare questo sistema senza considerare gli altri componenti del sistema.</span><span class="sxs-lookup"><span data-stu-id="b171f-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="b171f-122">Ad esempio, se un componente bearer token usa questo stack, dovrebbe funzionare senza interferenze da un meccanismo anti-CSRF che potrebbe anche usare lo stesso stack.</span><span class="sxs-lookup"><span data-stu-id="b171f-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="b171f-123">Quindi, il requisito finale: Isolation.</span><span class="sxs-lookup"><span data-stu-id="b171f-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="b171f-124">Microsoft può fornire ulteriori vincoli per limitare l'ambito dei requisiti.</span><span class="sxs-lookup"><span data-stu-id="b171f-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="b171f-125">Si presuppone che tutti i servizi che operano all'interno di cryptosystem siano ugualmente attendibili e che i dati non debbano essere generati o utilizzati al di fuori dei servizi sotto il controllo diretto.</span><span class="sxs-lookup"><span data-stu-id="b171f-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="b171f-126">Inoltre, è necessario che le operazioni siano il più veloci possibile poiché ogni richiesta al servizio Web potrebbe passare attraverso il cryptosystem una o più volte.</span><span class="sxs-lookup"><span data-stu-id="b171f-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="b171f-127">Questo rende la crittografia simmetrica ideale per questo scenario ed è possibile scontare la crittografia asimmetrica fino a un momento specifico.</span><span class="sxs-lookup"><span data-stu-id="b171f-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="b171f-128">Filosofia di progettazione</span><span class="sxs-lookup"><span data-stu-id="b171f-128">Design philosophy</span></span>

<span data-ttu-id="b171f-129">È stata avviata l'identificazione dei problemi con lo stack esistente.</span><span class="sxs-lookup"><span data-stu-id="b171f-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="b171f-130">Una volta completata questa situazione, abbiamo esaminato il panorama delle soluzioni esistenti ed è stato concluso che nessuna soluzione esistente aveva le funzionalità richieste.</span><span class="sxs-lookup"><span data-stu-id="b171f-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="b171f-131">È stata quindi progettata una soluzione basata su diversi principi di guida.</span><span class="sxs-lookup"><span data-stu-id="b171f-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="b171f-132">Il sistema deve offrire semplicità di configurazione.</span><span class="sxs-lookup"><span data-stu-id="b171f-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="b171f-133">Idealmente, la configurazione del sistema è zero e gli sviluppatori potrebbero raggiungere il terreno.</span><span class="sxs-lookup"><span data-stu-id="b171f-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="b171f-134">Nelle situazioni in cui gli sviluppatori devono configurare un aspetto specifico, ad esempio il repository delle chiavi, è necessario considerare la necessità di rendere semplici le configurazioni specifiche.</span><span class="sxs-lookup"><span data-stu-id="b171f-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="b171f-135">Offrire un'API semplice per gli utenti.</span><span class="sxs-lookup"><span data-stu-id="b171f-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="b171f-136">Le API dovrebbero essere facili da usare correttamente e difficili da usare in modo non corretto.</span><span class="sxs-lookup"><span data-stu-id="b171f-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="b171f-137">Gli sviluppatori non devono apprendere principi di gestione delle chiavi.</span><span class="sxs-lookup"><span data-stu-id="b171f-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="b171f-138">Il sistema deve gestire la selezione dell'algoritmo e la durata della chiave per conto dello sviluppatore.</span><span class="sxs-lookup"><span data-stu-id="b171f-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="b171f-139">Idealmente, lo sviluppatore non deve mai neanche avere accesso al materiale della chiave non elaborata.</span><span class="sxs-lookup"><span data-stu-id="b171f-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="b171f-140">Le chiavi devono essere protette quando possibile.</span><span class="sxs-lookup"><span data-stu-id="b171f-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="b171f-141">Il sistema deve individuare un meccanismo di protezione predefinito appropriato e applicarlo automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b171f-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="b171f-142">Con questi principi, abbiamo sviluppato uno stack di protezione dei dati semplice e semplice [da usare](xref:security/data-protection/using-data-protection) .</span><span class="sxs-lookup"><span data-stu-id="b171f-142">With these principles in mind we developed a simple, [easy to use](xref:security/data-protection/using-data-protection) data protection stack.</span></span>

<span data-ttu-id="b171f-143">Le API di protezione dei dati ASP.NET Core non sono destinate principalmente alla persistenza illimitata dei payload riservati.</span><span class="sxs-lookup"><span data-stu-id="b171f-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="b171f-144">Altre tecnologie come [DPAPI di Windows](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) e [Rights Management di Azure](/rights-management/) sono più adatte allo scenario di archiviazione indefinita e hanno funzionalità di gestione delle chiavi corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="b171f-144">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="b171f-145">Detto questo, non c'è nulla che impedisce agli sviluppatori di usare le API di protezione dei dati ASP.NET Core per la protezione a lungo termine dei dati riservati.</span><span class="sxs-lookup"><span data-stu-id="b171f-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="b171f-146">Destinatari</span><span class="sxs-lookup"><span data-stu-id="b171f-146">Audience</span></span>

<span data-ttu-id="b171f-147">Il sistema di protezione dei dati è suddiviso in cinque pacchetti principali.</span><span class="sxs-lookup"><span data-stu-id="b171f-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="b171f-148">I vari aspetti di queste API sono destinati a tre destinatari principali;</span><span class="sxs-lookup"><span data-stu-id="b171f-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="b171f-149">La [Panoramica delle API consumer](xref:security/data-protection/consumer-apis/overview) è destinata agli sviluppatori di applicazioni e Framework.</span><span class="sxs-lookup"><span data-stu-id="b171f-149">The [Consumer APIs Overview](xref:security/data-protection/consumer-apis/overview) target application and framework developers.</span></span>

   <span data-ttu-id="b171f-150">"Non voglio conoscere il funzionamento dello stack o la relativa configurazione.</span><span class="sxs-lookup"><span data-stu-id="b171f-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="b171f-151">Desidero semplicemente eseguire alcune operazioni nel modo più semplice possibile con la probabilità elevata di usare le API con successo. "</span><span class="sxs-lookup"><span data-stu-id="b171f-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="b171f-152">Le [API di configurazione](xref:security/data-protection/configuration/overview) sono destinate agli sviluppatori di applicazioni e agli amministratori di sistema.</span><span class="sxs-lookup"><span data-stu-id="b171f-152">The [configuration APIs](xref:security/data-protection/configuration/overview) target application developers and system administrators.</span></span>

   <span data-ttu-id="b171f-153">"Devo indicare al sistema di protezione dei dati che l'ambiente richiede percorsi o impostazioni non predefinite".</span><span class="sxs-lookup"><span data-stu-id="b171f-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="b171f-154">Le API di estendibilità sono destinate agli sviluppatori responsabili dell'implementazione dei criteri personalizzati.</span><span class="sxs-lookup"><span data-stu-id="b171f-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="b171f-155">L'utilizzo di queste API potrebbe essere limitato a situazioni rare e a sviluppatori esperti di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="b171f-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="b171f-156">"È necessario sostituire un intero componente all'interno del sistema perché sono presenti requisiti di comportamento realmente univoci.</span><span class="sxs-lookup"><span data-stu-id="b171f-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="b171f-157">Sono intenzionato a imparare le parti non comuni della superficie dell'API per creare un plug-in che soddisfi i requisiti ".</span><span class="sxs-lookup"><span data-stu-id="b171f-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="b171f-158">Layout del pacchetto</span><span class="sxs-lookup"><span data-stu-id="b171f-158">Package layout</span></span>

<span data-ttu-id="b171f-159">Lo stack di protezione dei dati è costituito da cinque pacchetti.</span><span class="sxs-lookup"><span data-stu-id="b171f-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="b171f-160">[Microsoft. AspNetCore. dataprotection. abstracts](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) contiene le interfacce <xref:Microsoft.AspNetCore.DataProtection.IDataProtectionProvider> e <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> per la creazione di servizi di protezione dei dati.</span><span class="sxs-lookup"><span data-stu-id="b171f-160">[Microsoft.AspNetCore.DataProtection.Abstractions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Abstractions/) contains the <xref:Microsoft.AspNetCore.DataProtection.IDataProtectionProvider> and <xref:Microsoft.AspNetCore.DataProtection.IDataProtector> interfaces to create data protection services.</span></span> <span data-ttu-id="b171f-161">Contiene inoltre metodi di estensione utili per l'utilizzo di questi tipi (ad esempio, [IDataProtector. Protect](xref:Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Protect*)).</span><span class="sxs-lookup"><span data-stu-id="b171f-161">It also contains useful extension methods for working with these types (for example, [IDataProtector.Protect](xref:Microsoft.AspNetCore.DataProtection.DataProtectionCommonExtensions.Protect*)).</span></span> <span data-ttu-id="b171f-162">Se viene creata un'istanza del sistema di protezione dei dati in un'altra posizione e si utilizza l'API, fare riferimento `Microsoft.AspNetCore.DataProtection.Abstractions`.</span><span class="sxs-lookup"><span data-stu-id="b171f-162">If the data protection system is instantiated elsewhere and you're consuming the API, reference `Microsoft.AspNetCore.DataProtection.Abstractions`.</span></span>

* <span data-ttu-id="b171f-163">[Microsoft. AspNetCore. dataprotection](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection/) contiene l'implementazione principale del sistema di protezione dei dati, tra cui operazioni di crittografia di base, gestione delle chiavi, configurazione ed estensibilità.</span><span class="sxs-lookup"><span data-stu-id="b171f-163">[Microsoft.AspNetCore.DataProtection](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection/) contains the core implementation of the data protection system, including core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="b171f-164">Per creare un'istanza del sistema di protezione dei dati (ad esempio, aggiungendolo a un <xref:Microsoft.Extensions.DependencyInjection.IServiceCollection>) o modificando o estendendo il comportamento, fare riferimento a `Microsoft.AspNetCore.DataProtection`.</span><span class="sxs-lookup"><span data-stu-id="b171f-164">To instantiate the data protection system (for example, adding it to an <xref:Microsoft.Extensions.DependencyInjection.IServiceCollection>) or modifying or extending its behavior, reference `Microsoft.AspNetCore.DataProtection`.</span></span>

* <span data-ttu-id="b171f-165">[Microsoft. AspNetCore. dataprotection. Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contiene altre API che gli sviluppatori possono trovare utili ma che non appartengono al pacchetto principale.</span><span class="sxs-lookup"><span data-stu-id="b171f-165">[Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="b171f-166">Ad esempio, questo pacchetto contiene i metodi factory per creare un'istanza del sistema di protezione dati per archiviare le chiavi in una posizione nella file system senza inserimento delle dipendenze (vedere <xref:Microsoft.AspNetCore.DataProtection.DataProtectionProvider>).</span><span class="sxs-lookup"><span data-stu-id="b171f-166">For instance, this package contains factory methods to instantiate the data protection system to store keys at a location on the file system without dependency injection (see <xref:Microsoft.AspNetCore.DataProtection.DataProtectionProvider>).</span></span> <span data-ttu-id="b171f-167">Contiene inoltre i metodi di estensione per limitare la durata dei payload protetti (vedere <xref:Microsoft.AspNetCore.DataProtection.ITimeLimitedDataProtector>).</span><span class="sxs-lookup"><span data-stu-id="b171f-167">It also contains extension methods for limiting the lifetime of protected payloads (see <xref:Microsoft.AspNetCore.DataProtection.ITimeLimitedDataProtector>).</span></span>

* <span data-ttu-id="b171f-168">[Microsoft. AspNetCore. dataprotection. systemWeb](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.SystemWeb/) può essere installato in un'app ASP.NET 4. x esistente per reindirizzare le operazioni di `<machineKey>` per l'uso della nuova ASP.NET Core stack di protezione dei dati.</span><span class="sxs-lookup"><span data-stu-id="b171f-168">[Microsoft.AspNetCore.DataProtection.SystemWeb](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.SystemWeb/) can be installed into an existing ASP.NET 4.x app to redirect its `<machineKey>` operations to use the new ASP.NET Core data protection stack.</span></span> <span data-ttu-id="b171f-169">Per altre informazioni, vedere <xref:security/data-protection/compatibility/replacing-machinekey>.</span><span class="sxs-lookup"><span data-stu-id="b171f-169">For more information, see <xref:security/data-protection/compatibility/replacing-machinekey>.</span></span>

* <span data-ttu-id="b171f-170">[Microsoft. AspNetCore. Cryptography. Derivation](https://www.nuget.org/packages/Microsoft.AspNetCore.Cryptography.KeyDerivation/) fornisce un'implementazione della routine di hashing delle password PBKDF2 e può essere utilizzata dai sistemi che devono gestire le password utente in modo sicuro.</span><span class="sxs-lookup"><span data-stu-id="b171f-170">[Microsoft.AspNetCore.Cryptography.KeyDerivation](https://www.nuget.org/packages/Microsoft.AspNetCore.Cryptography.KeyDerivation/) provides an implementation of the PBKDF2 password hashing routine and can be used by systems that must handle user passwords securely.</span></span> <span data-ttu-id="b171f-171">Per altre informazioni, vedere <xref:security/data-protection/consumer-apis/password-hashing>.</span><span class="sxs-lookup"><span data-stu-id="b171f-171">For more information, see <xref:security/data-protection/consumer-apis/password-hashing>.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="b171f-172">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="b171f-172">Additional resources</span></span>

<xref:host-and-deploy/web-farm>
