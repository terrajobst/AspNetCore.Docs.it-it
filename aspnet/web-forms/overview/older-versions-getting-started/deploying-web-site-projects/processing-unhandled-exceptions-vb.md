---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
title: L'elaborazione delle eccezioni non gestite (VB) | Documenti Microsoft
author: rick-anderson
description: "Quando si verifica un errore di runtime in un'applicazione web nell'ambiente di produzione è importante per notificare a uno sviluppatore e di registrare l'errore, in modo che può essere diagnosticata in un la..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: 051296f0-9519-4e78-835c-d868da13b0a0
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: c5a4d2e3468c9b7db5d3acf9f59fc13a6b791497
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/30/2018
---
<a name="processing-unhandled-exceptions-vb"></a><span data-ttu-id="2a728-103">L'elaborazione delle eccezioni non gestite (VB)</span><span class="sxs-lookup"><span data-stu-id="2a728-103">Processing Unhandled Exceptions (VB)</span></span>
====================
<span data-ttu-id="2a728-104">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2a728-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2a728-105">[Scaricare codice](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_12_VB.zip) o [Scarica il PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial12_ErrorHandling_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="2a728-105">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_12_VB.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial12_ErrorHandling_vb.pdf)</span></span>

> <span data-ttu-id="2a728-106">Quando si verifica un errore di runtime in un'applicazione web nell'ambiente di produzione è importante per notificare a uno sviluppatore e di registrare l'errore, in modo che può essere diagnosticata in un secondo momento nel tempo.</span><span class="sxs-lookup"><span data-stu-id="2a728-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="2a728-107">In questa esercitazione viene fornita una panoramica di come ASP.NET elabora gli errori di runtime ed esamina un modo per eseguire codice personalizzato ogni volta che un bolle di eccezione non gestita al runtime di ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2a728-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>


## <a name="introduction"></a><span data-ttu-id="2a728-108">Introduzione</span><span class="sxs-lookup"><span data-stu-id="2a728-108">Introduction</span></span>

<span data-ttu-id="2a728-109">Quando un'applicazione ASP.NET si verifica un'eccezione non gestita, propagata al runtime di ASP.NET, che genera il `Error` evento e viene visualizzata la pagina di errore appropriato.</span><span class="sxs-lookup"><span data-stu-id="2a728-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="2a728-110">Esistono tre tipi diversi di pagine di errore: il Runtime errore giallo schermata di morte (YSOD); i dettagli dell'eccezione YSOD; e pagine errori personalizzati.</span><span class="sxs-lookup"><span data-stu-id="2a728-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="2a728-111">Nel [esercitazione precedente](displaying-a-custom-error-page-vb.md) è l'applicazione configurata per utilizzare una pagina di errore personalizzata per gli utenti remoti e il YSOD Dettagli eccezione per gli utenti che visitano localmente.</span><span class="sxs-lookup"><span data-stu-id="2a728-111">In the [preceding tutorial](displaying-a-custom-error-page-vb.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="2a728-112">Utilizzo di una pagina di errore personalizzato adatto umane corrispondente l'aspetto del sito è preferito per il valore predefinito YSOD errore di Runtime, ma la visualizzazione di una pagina di errore personalizzato è solo una parte di un errore completo la soluzione di gestione.</span><span class="sxs-lookup"><span data-stu-id="2a728-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="2a728-113">Quando si verifica un errore in un'applicazione nell'ambiente di produzione, è importante che gli sviluppatori vengono visualizzata una notifica dell'errore in modo che possano Scopri la causa dell'eccezione e risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="2a728-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="2a728-114">Inoltre, i dettagli dell'errore devono essere registrati in modo che l'errore può essere esaminato e la diagnosi in un secondo momento nel tempo.</span><span class="sxs-lookup"><span data-stu-id="2a728-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="2a728-115">In questa esercitazione viene illustrato come accedere ai dettagli di un'eccezione non gestita in modo che questi possono essere registrati e uno sviluppatore di una notifica.</span><span class="sxs-lookup"><span data-stu-id="2a728-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="2a728-116">Le due esercitazioni seguente esplorare le librerie di registrazione errore che, dopo un po' di configurazione, vengono automaticamente notificare agli sviluppatori di errori di runtime e i relativi dettagli di log.</span><span class="sxs-lookup"><span data-stu-id="2a728-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="2a728-117">Le informazioni esaminate in questa esercitazione sono particolarmente utile se è necessario elaborare le eccezioni non gestite in modo esclusivo o personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2a728-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="2a728-118">Nei casi in cui è necessario solo per registrare l'eccezione e la notifica di uno sviluppatore, con un'errore durante la registrazione libreria è il modo per passare.</span><span class="sxs-lookup"><span data-stu-id="2a728-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="2a728-119">Le due esercitazioni forniscono una panoramica delle due librerie di questo tipo.</span><span class="sxs-lookup"><span data-stu-id="2a728-119">The next two tutorials provide an overview of two such libraries.</span></span>


## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="2a728-120">L'esecuzione di codice quando il`Error`evento</span><span class="sxs-lookup"><span data-stu-id="2a728-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="2a728-121">Eventi forniscono un oggetto di un meccanismo per segnalare che si è verificato qualcosa di interessante e eseguire codice in risposta di un altro oggetto.</span><span class="sxs-lookup"><span data-stu-id="2a728-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="2a728-122">In qualità di sviluppatore ASP.NET si è abituati a pensare in termini di eventi.</span><span class="sxs-lookup"><span data-stu-id="2a728-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="2a728-123">Se si desidera eseguire il codice quando il visitatore fa clic su un pulsante, si crea un gestore eventi per tale pulsante `Click` eventi e inserire il codice non esiste.</span><span class="sxs-lookup"><span data-stu-id="2a728-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="2a728-124">Dato che il runtime ASP.NET genera relativo [ `Error` evento](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) ogni volta che si verifica un'eccezione non gestita, ne consegue che il codice per registrare i dettagli dell'errore verrà attivato in un gestore eventi.</span><span class="sxs-lookup"><span data-stu-id="2a728-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="2a728-125">Ma come creare un gestore eventi per il `Error` evento?</span><span class="sxs-lookup"><span data-stu-id="2a728-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="2a728-126">Il `Error` è uno di molti eventi nel [ `HttpApplication` classe](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) che vengono generati in momenti diversi nella pipeline HTTP per la durata di una richiesta.</span><span class="sxs-lookup"><span data-stu-id="2a728-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="2a728-127">Ad esempio, il `HttpApplication` della classe [ `BeginRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) viene generato all'inizio di ogni richiesta; relativo [ `AuthenticateRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) viene generato quando un modulo di protezione ha identificato il richiedente.</span><span class="sxs-lookup"><span data-stu-id="2a728-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="2a728-128">Questi `HttpApplication` eventi forniscono allo sviluppatore della pagina un mezzo per eseguire la logica personalizzata in vari punti della durata di una richiesta.</span><span class="sxs-lookup"><span data-stu-id="2a728-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="2a728-129">Gestori eventi per il `HttpApplication` eventi possono essere inseriti in un file speciale denominato `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="2a728-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="2a728-130">Per creare questo file nel sito Web, aggiungere un nuovo elemento alla radice del sito Web utilizzando il modello di classe di applicazione globale con il nome `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="2a728-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-vb/_static/image2.png)](processing-unhandled-exceptions-vb/_static/image1.png)

<span data-ttu-id="2a728-131">**Figura 1**: aggiungere `Global.asax` all'applicazione Web</span><span class="sxs-lookup"><span data-stu-id="2a728-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
 <span data-ttu-id="2a728-132">([Fare clic per visualizzare l'immagine ingrandita](processing-unhandled-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="2a728-132">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="2a728-133">Il contenuto e la struttura del `Global.asax` file creata da Visual Studio variano leggermente in base sull'utilizzo di un progetto di applicazione Web (WAP) o un progetto di sito Web (WSP).</span><span class="sxs-lookup"><span data-stu-id="2a728-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="2a728-134">Con un WAP, il `Global.asax` viene implementata come due file diversi - `Global.asax` e `Global.asax.vb`.</span><span class="sxs-lookup"><span data-stu-id="2a728-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.vb`.</span></span> <span data-ttu-id="2a728-135">Il `Global.asax` file non contiene alcun elemento, ma un `@Application` direttiva che fa riferimento il `.vb` file; l'evento di gestori di interesse vengono definiti nel `Global.asax.vb` file.</span><span class="sxs-lookup"><span data-stu-id="2a728-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.vb` file; the event handlers of interest are defined in the `Global.asax.vb` file.</span></span> <span data-ttu-id="2a728-136">Per WSPs, viene creato un singolo file, `Global.asax`, e i gestori di eventi sono definiti in un `<script runat="server">` blocco.</span><span class="sxs-lookup"><span data-stu-id="2a728-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="2a728-137">Il `Global.asax` file creati in un WAP dal modello di classe di applicazione globale di Visual Studio include i gestori eventi denominati `Application_BeginRequest`, `Application_AuthenticateRequest`, e `Application_Error`, quali sono i gestori eventi per il `HttpApplication` eventi `BeginRequest`, `AuthenticateRequest`, e `Error`, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="2a728-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="2a728-138">Sono disponibili anche i gestori eventi denominati `Application_Start`, `Session_Start`, `Application_End`, e `Session_End`, quali sono i gestori di eventi che attivano all'avvio dell'applicazione web, quando viene avviata una nuova sessione, al termine dell'applicazione e quando termina una sessione, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="2a728-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="2a728-139">Il `Global.asax` file creati per Visual Studio in un pacchetto WSP contiene solo il `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, e `Session_End` gestori eventi.</span><span class="sxs-lookup"><span data-stu-id="2a728-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="2a728-140">Quando si distribuisce l'applicazione ASP.NET è necessario copiare il `Global.asax` file nell'ambiente di produzione.</span><span class="sxs-lookup"><span data-stu-id="2a728-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="2a728-141">Il `Global.asax.vb` file, viene creato nel WAP, non deve essere copiato nell'ambiente di produzione, perché questo codice viene compilato in assembly del progetto.</span><span class="sxs-lookup"><span data-stu-id="2a728-141">The `Global.asax.vb` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>


<span data-ttu-id="2a728-142">I gestori eventi creati dal modello di classe di applicazione globale di Visual Studio non sono esaustivi.</span><span class="sxs-lookup"><span data-stu-id="2a728-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="2a728-143">È possibile aggiungere un gestore eventi per qualsiasi `HttpApplication` evento assegnando il gestore dell'evento `Application_EventName`.</span><span class="sxs-lookup"><span data-stu-id="2a728-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="2a728-144">Ad esempio, è possibile aggiungere il codice seguente per il `Global.asax` file per creare un gestore eventi per il [ `AuthorizeRequest` evento](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="2a728-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample1.vb)]

<span data-ttu-id="2a728-145">Analogamente, è possibile rimuovere i gestori eventi creati dal modello di classe di applicazione globale che non sono necessari.</span><span class="sxs-lookup"><span data-stu-id="2a728-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="2a728-146">Per questa esercitazione è necessario solo un gestore eventi per il `Error` eventi; contattarmi per altri gestori di eventi da rimuovere il `Global.asax` file.</span><span class="sxs-lookup"><span data-stu-id="2a728-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="2a728-147">*I moduli HTTP* offrono un altro modo per definire i gestori eventi per `HttpApplication` eventi.</span><span class="sxs-lookup"><span data-stu-id="2a728-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="2a728-148">I moduli HTTP vengono creati come file di classe che può essere direttamente nel progetto di applicazione web o suddivisi in una libreria di classi separato.</span><span class="sxs-lookup"><span data-stu-id="2a728-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="2a728-149">Poiché possono essere suddivisi in una libreria di classi, moduli HTTP offrono un modello più flessibile e riutilizzabile per la creazione di `HttpApplication` gestori eventi.</span><span class="sxs-lookup"><span data-stu-id="2a728-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="2a728-150">Mentre il `Global.asax` è specifico per l'applicazione web in cui si trova, moduli HTTP possono essere compilati in assembly, a quel punto aggiungere il modulo HTTP a un sito Web è semplice come l'eliminazione di assembly il `Bin` cartella e la registrazione il Modulo `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="2a728-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="2a728-151">In questa esercitazione non corrisponde alla creazione e uso di moduli HTTP, ma le librerie di registrazione degli errori due utilizzate nelle due esercitazioni seguenti vengono implementate come moduli HTTP.</span><span class="sxs-lookup"><span data-stu-id="2a728-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="2a728-152">Per ulteriori informazioni sui vantaggi di moduli HTTP fare riferimento a [tramite moduli e i gestori per creare componenti ASP.NET collegabili](https://msdn.microsoft.com/library/aa479332.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a728-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>


## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="2a728-153">Il recupero delle informazioni sull'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="2a728-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="2a728-154">A questo punto si dispone di un file Global. asax con un `Application_Error` gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="2a728-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="2a728-155">Quando si esegue questo gestore eventi è necessario inviare una notifica di uno sviluppatore dell'errore e registrare i dettagli.</span><span class="sxs-lookup"><span data-stu-id="2a728-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="2a728-156">Per eseguire queste operazioni è necessario innanzitutto determinare i dettagli dell'eccezione che è stato generato.</span><span class="sxs-lookup"><span data-stu-id="2a728-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="2a728-157">Utilizzare l'oggetto Server [ `GetLastError` metodo](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) per recuperare i dettagli dell'eccezione non gestita che ha causato il `Error` dell'evento da generare.</span><span class="sxs-lookup"><span data-stu-id="2a728-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="2a728-158">Il `GetLastError` il metodo restituisce un oggetto di tipo `Exception`, ovvero il tipo di base per tutte le eccezioni in .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2a728-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="2a728-159">Tuttavia, nel codice precedente è cast dell'oggetto di eccezione restituito da `GetLastError` in un `HttpException` oggetto.</span><span class="sxs-lookup"><span data-stu-id="2a728-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="2a728-160">Se il `Error` evento viene generato perché è stata generata un'eccezione durante l'elaborazione di una risorsa ASP.NET, quindi viene eseguito il wrapping di un'eccezione che è stata generata un'eccezione all'interno di un `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="2a728-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="2a728-161">Per ottenere l'eccezione che ha generato l'utilizzo di eventi di errore di `InnerException` proprietà.</span><span class="sxs-lookup"><span data-stu-id="2a728-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="2a728-162">Se il `Error` è stato generato l'evento a causa di un'eccezione basata su HTTP, ad esempio una richiesta per una pagina non esistente, un `HttpException` viene generata un'eccezione, ma non dispone di un'eccezione interna.</span><span class="sxs-lookup"><span data-stu-id="2a728-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="2a728-163">Il codice seguente usa il `GetLastErrormessage` per recuperare le informazioni sull'eccezione che ha attivato il `Error` evento, l'archiviazione di `HttpException` in una variabile denominata `lastErrorWrapper`.</span><span class="sxs-lookup"><span data-stu-id="2a728-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="2a728-164">Archivia quindi il tipo di un messaggio e traccia dello stack dell'eccezione origine nelle tre variabili di stringa, un controllo per verificare se il `lastErrorWrapper` è l'eccezione che ha attivato il `Error` eventi (nel caso di eccezioni basato su HTTP) o se è semplicemente un wrapper per un'eccezione generata durante l'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="2a728-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="2a728-165">A questo punto si dispone di tutte le informazioni necessarie per scrivere codice che verrà registrati i dettagli dell'eccezione in una tabella di database.</span><span class="sxs-lookup"><span data-stu-id="2a728-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="2a728-166">È possibile creare una tabella di database con colonne per ogni i dettagli dell'errore di interesse - il tipo, il messaggio, la traccia dello stack e così via - assieme ad altre utile di informazioni, ad esempio l'URL della pagina richiesta e il nome dell'utente attualmente connesso.</span><span class="sxs-lookup"><span data-stu-id="2a728-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="2a728-167">Nel `Application_Error` gestore dell'evento verrà quindi connettersi al database e inserire un record nella tabella.</span><span class="sxs-lookup"><span data-stu-id="2a728-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="2a728-168">Analogamente, è possibile aggiungere codice per uno sviluppatore dell'errore tramite posta elettronica di avviso.</span><span class="sxs-lookup"><span data-stu-id="2a728-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="2a728-169">Le librerie di registrazione errore esaminate nelle prossime due esercitazioni forniscono tali funzionalità predefinita, in modo non è necessario per compilare la registrazione degli errori e notifica.</span><span class="sxs-lookup"><span data-stu-id="2a728-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="2a728-170">Tuttavia, per illustrare che il `Error` evento viene generato e che il `Application_Error` gestore eventi può essere utilizzato per registrare i dettagli dell'errore e inviare una notifica a uno sviluppatore, aggiungere codice che notifica a uno sviluppatore quando si verifica un errore.</span><span class="sxs-lookup"><span data-stu-id="2a728-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="2a728-171">Notifica a uno sviluppatore quando si verifica un'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="2a728-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="2a728-172">Quando si verifica un'eccezione non gestita nell'ambiente di produzione è importante avvertire il team di sviluppo in modo che possano valutare l'errore e determinare cosa è necessario eseguire alcune azioni.</span><span class="sxs-lookup"><span data-stu-id="2a728-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="2a728-173">Ad esempio, se è presente un errore durante la connessione al database, è necessario in un tipo double controllare la stringa di connessione e, forse, aprire un ticket di supporto con la società di hosting web.</span><span class="sxs-lookup"><span data-stu-id="2a728-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="2a728-174">Se si è verificata l'eccezione a causa di un errore di programmazione, potrebbe essere necessario codice aggiuntivo o la logica di convalida da aggiungere per evitare tali errori in futuro.</span><span class="sxs-lookup"><span data-stu-id="2a728-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="2a728-175">Le classi .NET Framework nel [ `System.Net.Mail` dello spazio dei nomi](https://msdn.microsoft.com/library/system.net.mail.aspx) semplificano inviare un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="2a728-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="2a728-176">Il [ `MailMessage` classe](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) rappresenta un messaggio di posta elettronica e dispone di proprietà quali `To`, `From`, `Subject`, `Body`, e `Attachments`.</span><span class="sxs-lookup"><span data-stu-id="2a728-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="2a728-177">Il `SmtpClass` viene utilizzato per inviare un `MailMessage` oggetto utilizza un server SMTP specificato; le impostazioni del server SMTP possono essere specificate a livello di programmazione o in modo dichiarativo nel [ `<system.net>` elemento](https://msdn.microsoft.com/library/6484zdc1.aspx) nel `Web.config file`.</span><span class="sxs-lookup"><span data-stu-id="2a728-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="2a728-178">Per ulteriori informazioni sull'invio di posta elettronica i messaggi in un'applicazione ASP.NET vedere l'articolo, [l'invio di posta elettronica in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)e [domande frequenti su System.Net.Mail](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="2a728-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="2a728-179">Il `<system.net>` elemento contiene le impostazioni del server SMTP utilizzate dalla `SmtpClient` classe quando si invia un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="2a728-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="2a728-180">Probabilmente società di hosting web dispone di un server SMTP che è possibile utilizzare per inviare posta elettronica dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="2a728-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="2a728-181">Per informazioni sulle impostazioni del server SMTP, che è consigliabile utilizzare nell'applicazione web, consultare la sezione di supporto dell'host web.</span><span class="sxs-lookup"><span data-stu-id="2a728-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>


<span data-ttu-id="2a728-182">Aggiungere il codice seguente per il `Application_Error` gestore eventi per l'invio di uno sviluppatore di un messaggio di posta elettronica quando si verifica un errore:</span><span class="sxs-lookup"><span data-stu-id="2a728-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample4.vb)]

<span data-ttu-id="2a728-183">Mentre il codice sopra riportato è piuttosto lungo, la maggior parte di esso crea il codice HTML visualizzato il messaggio di posta elettronica per gli sviluppatori.</span><span class="sxs-lookup"><span data-stu-id="2a728-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="2a728-184">Il codice di avvio facendo riferimento al `HttpException` restituito dal `GetLastError` metodo (`lastErrorWrapper`).</span><span class="sxs-lookup"><span data-stu-id="2a728-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="2a728-185">L'eccezione che è stato generato dalla richiesta è stato recuperato tramite `lastErrorWrapper.InnerException` e viene assegnato alla variabile `lastError`.</span><span class="sxs-lookup"><span data-stu-id="2a728-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="2a728-186">Il tipo di un messaggio e stack di informazioni di traccia vengono recuperate dal `lastError` e archiviati in tre variabili stringa.</span><span class="sxs-lookup"><span data-stu-id="2a728-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="2a728-187">Successivamente, un `MailMessage` oggetto denominato `mm` viene creato.</span><span class="sxs-lookup"><span data-stu-id="2a728-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="2a728-188">Il corpo del messaggio di posta elettronica è in formato HTML e visualizza l'URL della pagina richiesta, il nome dell'utente attualmente connesso e informazioni sull'eccezione (il tipo di messaggio e traccia dello stack).</span><span class="sxs-lookup"><span data-stu-id="2a728-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="2a728-189">Una delle caratteristiche più interessanti di `HttpException` classe è che è possibile generare il codice HTML utilizzato per creare l'eccezione dettagli giallo schermata di morte (YSOD) chiamando il [GetHtmlErrorMessage metodo](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span><span class="sxs-lookup"><span data-stu-id="2a728-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="2a728-190">Questo metodo è usato per recuperare il codice di eccezione dettagli YSOD e aggiungerlo al messaggio di posta elettronica come allegato.</span><span class="sxs-lookup"><span data-stu-id="2a728-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="2a728-191">Attenzione: se l'eccezione che ha attivato il `Error` evento è verificata un'eccezione basata su HTTP (ad esempio una richiesta per una pagina inesistente) il `GetHtmlErrorMessage` metodo restituirà `null`.</span><span class="sxs-lookup"><span data-stu-id="2a728-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="2a728-192">Il passaggio finale consiste nella trasmissione di `MailMessage`.</span><span class="sxs-lookup"><span data-stu-id="2a728-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="2a728-193">Questa operazione viene eseguita creando un nuovo `SmtpClient` metodo e chiamando il relativo `Send` metodo.</span><span class="sxs-lookup"><span data-stu-id="2a728-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="2a728-194">Prima di utilizzare questo codice nell'applicazione web è opportuno modificare i valori di `ToAddress` e `FromAddress` costanti support@example.com per posta elettronica indirizzo di posta elettronica di notifica di errore devono essere inviati a e provengono da.</span><span class="sxs-lookup"><span data-stu-id="2a728-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="2a728-195">È inoltre necessario specificare le impostazioni del server SMTP nel `<system.net>` sezione `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="2a728-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="2a728-196">Consultare il provider di hosting web per determinare le impostazioni del server SMTP da utilizzare.</span><span class="sxs-lookup"><span data-stu-id="2a728-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>


<span data-ttu-id="2a728-197">Con questo codice nella posizione ogni volta che si verifica un errore lo sviluppatore viene inviato un messaggio di posta elettronica che riepiloga l'errore e include il YSOD.</span><span class="sxs-lookup"><span data-stu-id="2a728-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="2a728-198">Nell'esercitazione precedente è illustrato un errore di runtime visita Genre.aspx e passando un oggetto non valido `ID` valore tramite la stringa di query, ad esempio `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="2a728-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="2a728-199">Visitare la pagina con il `Global.asax` file sul posto genera la stessa esperienza utente, come nell'esercitazione precedente - nell'ambiente di sviluppo si procederà vedere l'eccezione dettagli giallo schermata di morte, mentre nell'ambiente di produzione, sarà necessario vedere la pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2a728-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="2a728-200">Oltre a questo comportamento esistente, lo sviluppatore viene inviato un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="2a728-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="2a728-201">**Figura 2** Mostra messaggio di posta elettronica ricevuto durante la visita `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="2a728-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="2a728-202">Il corpo del messaggio di posta elettronica vengono riepilogate le informazioni sull'eccezione, mentre il `YSOD.htm` allegato viene visualizzato il contenuto visualizzato nel YSOD di dettagli di eccezione (vedere **figura 3**).</span><span class="sxs-lookup"><span data-stu-id="2a728-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image5.png)](processing-unhandled-exceptions-vb/_static/image4.png)

<span data-ttu-id="2a728-203">**Figura 2**: lo sviluppatore viene inviato una notifica di posta elettronica ogni volta che si verifica un'eccezione non gestita</span><span class="sxs-lookup"><span data-stu-id="2a728-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
 <span data-ttu-id="2a728-204">([Fare clic per visualizzare l'immagine ingrandita](processing-unhandled-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="2a728-204">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-vb/_static/image8.png)](processing-unhandled-exceptions-vb/_static/image7.png)

<span data-ttu-id="2a728-205">**Figura 3**: la notifica di posta elettronica include i dettagli dell'eccezione YSOD come allegato</span><span class="sxs-lookup"><span data-stu-id="2a728-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
 <span data-ttu-id="2a728-206">([Fare clic per visualizzare l'immagine ingrandita](processing-unhandled-exceptions-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="2a728-206">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="2a728-207">Cosa succede utilizzando la pagina di errore personalizzati?</span><span class="sxs-lookup"><span data-stu-id="2a728-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="2a728-208">In questa esercitazione viene illustrato come utilizzare `Global.asax` e `Application_Error` gestore dell'evento per eseguire codice quando si verifica un'eccezione non gestita.</span><span class="sxs-lookup"><span data-stu-id="2a728-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="2a728-209">In particolare, è utilizzato il gestore eventi per notificare a uno sviluppatore di un errore. è possibile estendere in modo da registrare anche i dettagli dell'errore in un database.</span><span class="sxs-lookup"><span data-stu-id="2a728-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="2a728-210">La presenza del `Application_Error` gestore dell'evento non influisce sulla esperienza dell'utente finale.</span><span class="sxs-lookup"><span data-stu-id="2a728-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="2a728-211">Sono ancora vedere la pagina di errore configurata, sia essa YSOD di dettagli di errore, il YSOD di errore di Runtime o la pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2a728-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="2a728-212">È naturale chiedersi se la `Global.asax` file e `Application_Error` eventi sono necessario quando si utilizza una pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2a728-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="2a728-213">Quando si verifica un errore all'utente viene visualizzata la pagina di errore personalizzati così perché non è stato inserito il codice per notificare lo sviluppatore e i dettagli dell'errore di log nella classe code-behind della pagina di errore personalizzati?</span><span class="sxs-lookup"><span data-stu-id="2a728-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="2a728-214">Mentre è certamente possibile aggiungere codice alla classe code-behind della pagina di errore personalizzato non si dispone dell'accesso per i dettagli dell'eccezione che ha attivato il `Error` evento quando si usa la tecnica, è esplorare nell'esercitazione precedente.</span><span class="sxs-lookup"><span data-stu-id="2a728-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="2a728-215">La chiamata di `GetLastError` metodo dalla pagina di errore personalizzato restituisce `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="2a728-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="2a728-216">Il motivo per questo comportamento è raggiunto la pagina di errore personalizzato tramite un reindirizzamento.</span><span class="sxs-lookup"><span data-stu-id="2a728-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="2a728-217">Quando un'eccezione non gestita raggiunge il runtime di ASP.NET il motore ASP.NET genera relativo `Error` eventi (che esegue il `Application_Error` gestore eventi) e quindi *reindirizza* l'utente alla pagina di errore personalizzato eseguendo un `Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="2a728-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="2a728-218">Il `Response.Redirect` metodo invia una risposta al client con un codice di stato HTTP 302 che indicano il browser per richiedere un nuovo URL, vale a dire la pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2a728-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="2a728-219">Il browser richiede quindi automaticamente la nuova pagina.</span><span class="sxs-lookup"><span data-stu-id="2a728-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="2a728-220">È possibile indicare che la pagina di errore personalizzato è stato richiesto separatamente dalla pagina in cui l'errore ha origine dal momento che cambia la barra degli indirizzi del browser all'URL di pagina di errore personalizzato (vedere **figura 4**).</span><span class="sxs-lookup"><span data-stu-id="2a728-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image11.png)](processing-unhandled-exceptions-vb/_static/image10.png)

<span data-ttu-id="2a728-221">**Figura 4**: quando si verifica un errore il Browser viene reindirizzato all'URL di pagina di errore personalizzati</span><span class="sxs-lookup"><span data-stu-id="2a728-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
 <span data-ttu-id="2a728-222">([Fare clic per visualizzare l'immagine ingrandita](processing-unhandled-exceptions-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="2a728-222">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image12.png))</span></span>

<span data-ttu-id="2a728-223">L'effetto finale è che la richiesta in cui si è verificata l'eccezione non gestita termina quando il server risponde con il reindirizzamento HTTP 302.</span><span class="sxs-lookup"><span data-stu-id="2a728-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="2a728-224">La richiesta successiva alla pagina di errore personalizzata è una nuova richiesta. a questo punto ASP.NET motore ha eliminato le informazioni sull'errore e, inoltre, non è possibile associare l'eccezione non gestita nella richiesta precedente con la nuova richiesta per la pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2a728-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="2a728-225">Questo è il motivo `GetLastError` restituisce `null` quando viene chiamato dalla pagina di errore personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2a728-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="2a728-226">Tuttavia, è possibile avere una pagina di errore personalizzata eseguita durante la stessa richiesta che ha causato l'errore.</span><span class="sxs-lookup"><span data-stu-id="2a728-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="2a728-227">Il [ `Server.Transfer(url)` ](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) metodo trasferisce l'esecuzione all'URL specificato e lo elabora all'interno della stessa richiesta.</span><span class="sxs-lookup"><span data-stu-id="2a728-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="2a728-228">È possibile spostare il codice di `Application_Error` gestore eventi per classe code-behind della pagina di errore personalizzata, sostituirla in `Global.asax` con il codice seguente:</span><span class="sxs-lookup"><span data-stu-id="2a728-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="2a728-229">A questo punto quando si verifica un'eccezione non gestita di `Application_Error` gestore trasferisce il controllo alla pagina di errore personalizzato appropriato in base al codice di stato HTTP.</span><span class="sxs-lookup"><span data-stu-id="2a728-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="2a728-230">Poiché il controllo è stato trasferito, pagina di errore personalizzata può accedere alle informazioni sull'eccezione non gestita tramite `Server.GetLastError` e inviare una notifica a uno sviluppatore dell'errore e registrare i dettagli.</span><span class="sxs-lookup"><span data-stu-id="2a728-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="2a728-231">Il `Server.Transfer` chiamata Arresta il motore ASP.NET da reindirizzamento dell'utente alla pagina di errore personalizzata.</span><span class="sxs-lookup"><span data-stu-id="2a728-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="2a728-232">Contenuto della pagina di errore personalizzato, invece, viene restituito come risposta alla pagina che ha generato l'errore.</span><span class="sxs-lookup"><span data-stu-id="2a728-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="2a728-233">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="2a728-233">Summary</span></span>

<span data-ttu-id="2a728-234">Quando si verifica un'eccezione non gestita in un'applicazione web ASP.NET il runtime ASP.NET genera il `Error` evento e viene visualizzata la pagina di errore configurate.</span><span class="sxs-lookup"><span data-stu-id="2a728-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="2a728-235">È possibile ricevere lo sviluppatore dell'errore, effettuare i dettagli o elaborarlo in qualche modo, tramite la creazione di un gestore eventi per l'evento di errore.</span><span class="sxs-lookup"><span data-stu-id="2a728-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="2a728-236">Esistono due modi per creare un gestore eventi per `HttpApplication` eventi come `Error`: nel `Global.asax` file o da un modulo HTTP.</span><span class="sxs-lookup"><span data-stu-id="2a728-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="2a728-237">In questa esercitazione viene illustrato come creare un `Error` nel gestore dell'evento di `Global.asax` file che gli sviluppatori di un errore di notifica tramite un messaggio di posta elettronica.</span><span class="sxs-lookup"><span data-stu-id="2a728-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="2a728-238">Creazione di un `Error` gestore eventi è utile se è necessario elaborare le eccezioni non gestite in modo esclusivo o personalizzato.</span><span class="sxs-lookup"><span data-stu-id="2a728-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="2a728-239">Tuttavia, la creazione di propri `Error` gestore eventi per registrare l'eccezione o per notificare a uno sviluppatore non è l'utilizzo più efficiente del tempo perché esistono già le librerie di registrazione errore gratuito e facile da utilizzare che sono possibile configurare in pochi minuti.</span><span class="sxs-lookup"><span data-stu-id="2a728-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="2a728-240">Le due esercitazioni esaminare due tali librerie.</span><span class="sxs-lookup"><span data-stu-id="2a728-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="2a728-241">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="2a728-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="2a728-242">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="2a728-242">Further Reading</span></span>

<span data-ttu-id="2a728-243">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, vedere le risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="2a728-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="2a728-244">Moduli ASP.NET e Cenni preliminari sui gestori HTTP</span><span class="sxs-lookup"><span data-stu-id="2a728-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="2a728-245">Risponde correttamente alle eccezioni non gestite - l'elaborazione delle eccezioni non gestite</span><span class="sxs-lookup"><span data-stu-id="2a728-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="2a728-246">`HttpApplication`Classe e l'oggetto applicazione ASP.NET</span><span class="sxs-lookup"><span data-stu-id="2a728-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="2a728-247">I gestori HTTP e moduli HTTP in ASP.NET</span><span class="sxs-lookup"><span data-stu-id="2a728-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="2a728-248">L'invio di posta elettronica in ASP.NET</span><span class="sxs-lookup"><span data-stu-id="2a728-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="2a728-249">La comprensione di `Global.asax` File</span><span class="sxs-lookup"><span data-stu-id="2a728-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="2a728-250">Utilizzo di gestori e i moduli HTTP per creare componenti ASP.NET collegabili</span><span class="sxs-lookup"><span data-stu-id="2a728-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="2a728-251">Utilizzo di ASP.NET `Global.asax` File</span><span class="sxs-lookup"><span data-stu-id="2a728-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="2a728-252">Utilizzo di `HttpApplication` istanze</span><span class="sxs-lookup"><span data-stu-id="2a728-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

>[!div class="step-by-step"]
<span data-ttu-id="2a728-253">[Precedente](displaying-a-custom-error-page-vb.md)
[Successivo](logging-error-details-with-asp-net-health-monitoring-vb.md)</span><span class="sxs-lookup"><span data-stu-id="2a728-253">[Previous](displaying-a-custom-error-page-vb.md)
[Next](logging-error-details-with-asp-net-health-monitoring-vb.md)</span></span>
