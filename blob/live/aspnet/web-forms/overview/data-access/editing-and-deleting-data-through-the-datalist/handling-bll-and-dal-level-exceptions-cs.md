---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
title: Gestione delle eccezioni BLL e DAL livello (c#) | Documenti Microsoft
author: rick-anderson
description: In questa esercitazione, vedremo come tactfully gestire le eccezioni generate durante l'aggiornamento flusso di lavoro di DataList un modificabile.
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/30/2006
ms.topic: article
ms.assetid: f8fd58e2-f932-4f08-ab3d-fbf8ff3295d2
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 659976d40f6109422f222d794b54d837faeb0764
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/10/2017
---
<a name="handling-bll--and-dal-level-exceptions-c"></a><span data-ttu-id="ebf3b-103">Gestione delle eccezioni BLL e DAL livello (c#)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-103">Handling BLL- and DAL-Level Exceptions (C#)</span></span>
====================
<span data-ttu-id="ebf3b-104">da [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="ebf3b-105">[Scaricare App di esempio](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) o [Scarica il PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span></span>

> <span data-ttu-id="ebf3b-106">In questa esercitazione, vedremo come tactfully gestire le eccezioni generate durante l'aggiornamento flusso di lavoro di DataList un modificabile.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>


## <a name="introduction"></a><span data-ttu-id="ebf3b-107">Introduzione</span><span class="sxs-lookup"><span data-stu-id="ebf3b-107">Introduction</span></span>

<span data-ttu-id="ebf3b-108">Nel [Panoramica della modifica e l'eliminazione di dati in DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) esercitazione, è stato creato un controllo DataList che offerti semplice eliminazione e modifica di funzionalità.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="ebf3b-109">Mentre pienamente funzionali, era difficilmente descrittivo, come qualsiasi errore che si è verificato durante la modifica o eliminazione di processo ha generato un'eccezione non gestita.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="ebf3b-110">Ad esempio, omettere il nome del prodotto s o quando si modifica un prodotto, immettere il valore di prezzo molto conveniente!, genera un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="ebf3b-111">Poiché nel codice non viene rilevata questa eccezione, propagata al runtime di ASP.NET, che consente di visualizzare i dettagli dell'eccezione s nella pagina web.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="ebf3b-112">Come illustrato nel [BLL - gestione e le eccezioni DAL livello in una pagina ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) esercitazione, se viene generata un'eccezione dalle profondità della logica di Business o i livelli di accesso ai dati, i dettagli dell'eccezione vengono restituiti a ObjectDataSource e quindi a GridView.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="ebf3b-113">È stato illustrato come gestire correttamente queste eccezioni creando `Updated` o `RowUpdated` gestori eventi per il ObjectDataSource o GridView, verifica di un'eccezione e quindi che indica che è stata gestita l'eccezione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="ebf3b-114">Le DataList esercitazioni, tuttavia, t utilizzando ObjectDataSource per l'aggiornamento e l'eliminazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-114">Our DataList tutorials, however, aren t using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="ebf3b-115">In alternativa, stiamo lavorando direttamente in base al livello Business LOGIC.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="ebf3b-116">Per rilevare le eccezioni provenienti dal livello Business LOGIC o DAL, è necessario implementare il code-behind della nostra pagina ASP.NET all'interno di gestione delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="ebf3b-117">In questa esercitazione, vedremo come più tactfully gestire le eccezioni generate durante una s DataList modificabile, l'aggiornamento del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="ebf3b-118">Nel *una panoramica di modifica e l'eliminazione di dati in DataList* esercitazione abbiamo parlato delle diverse tecniche per la modifica e l'eliminazione di dati da DataList alcune tecniche coinvolti utilizzando ObjectDataSource per l'aggiornamento e l'eliminazione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="ebf3b-119">Se queste tecniche, è possibile gestire eccezioni dal BLL o DAL attraverso il s ObjectDataSource `Updated` o `Deleted` gestori eventi.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>


## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="ebf3b-120">Passaggio 1: Creazione di un DataList modificabile</span><span class="sxs-lookup"><span data-stu-id="ebf3b-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="ebf3b-121">Prima di preoccupazione la gestione delle eccezioni che si verificano durante l'aggiornamento del flusso di lavoro, consentire s creare innanzitutto un DataList modificabile.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="ebf3b-122">Aprire il `ErrorHandling.aspx` nella pagina il `EditDeleteDataList` cartella, aggiungere un controllo DataList nella finestra di progettazione, imposta il relativo `ID` proprietà `Products`, e aggiungere un nuovo oggetto ObjectDataSource denominato `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="ebf3b-123">Configurare ObjectDataSource per utilizzare il `ProductsBLL` classe s `GetProducts()` metodo per la selezione di record, impostare gli elenchi a discesa nell'istruzione INSERT, UPDATE ed eliminare le tabulazioni su (nessuno).</span><span class="sxs-lookup"><span data-stu-id="ebf3b-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="ebf3b-124">[![Restituire le informazioni sul prodotto utilizzando il metodo GetProducts()](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span></span>

<span data-ttu-id="ebf3b-125">**Figura 1**: restituire le informazioni di prodotto usando il `GetProducts()` metodo ([fare clic per visualizzare l'immagine ingrandita](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="ebf3b-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span></span>


<span data-ttu-id="ebf3b-126">Dopo aver completato la procedura guidata ObjectDataSource, Visual Studio crea automaticamente un `ItemTemplate` per DataList.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="ebf3b-127">Sostituire con un `ItemTemplate` che consente di visualizzare ogni nome di prodotto s e prezzo e include un pulsante Modifica.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="ebf3b-128">Creare quindi un `EditItemTemplate` con un controllo casella di testo Web per nome, prezzo e pulsanti Aggiorna e Annulla.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="ebf3b-129">Infine, impostare DataList s `RepeatColumns` proprietà su 2.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="ebf3b-130">Dopo aver apportato queste modifiche, markup dichiarativo s pagina dovrebbe essere simile al seguente.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="ebf3b-131">Controllare per verificare che la modifica, annullamento, e i pulsanti di aggiornamento, i relativi `CommandName` proprietà impostate per modificare, annullare e aggiornare, rispettivamente.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="ebf3b-132">Per questa esercitazione DataList è necessario abilitare lo stato di visualizzazione s.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-132">For this tutorial the DataList s view state must be enabled.</span></span>


<span data-ttu-id="ebf3b-133">Dedicare alcuni minuti per visualizzare l'avanzamento attraverso un browser (vedere la figura 2).</span><span class="sxs-lookup"><span data-stu-id="ebf3b-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>


<span data-ttu-id="ebf3b-134">[![Ogni prodotto include un pulsante Modifica](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span></span>

<span data-ttu-id="ebf3b-135">**Figura 2**: ogni prodotto include un pulsante Modifica ([fare clic per visualizzare l'immagine ingrandita](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="ebf3b-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span></span>


<span data-ttu-id="ebf3b-136">Attualmente, solo il pulsante modifica provoca un postback, t ancora rendono il prodotto modificabile.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="ebf3b-137">Per consentire la modifica, è necessario creare gestori eventi per il controllo DataList s `EditCommand`, `CancelCommand`, e `UpdateCommand` eventi.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="ebf3b-138">Il `EditCommand` e `CancelCommand` eventi limitarsi ad aggiornare DataList s `EditItemIndex` proprietà e i dati da DataList riassociazione:</span><span class="sxs-lookup"><span data-stu-id="ebf3b-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="ebf3b-139">Il `UpdateCommand` gestore eventi è un po' più complicata.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="ebf3b-140">È necessario leggere nel prodotto modificato s `ProductID` dal `DataKeys` insieme con il nome del prodotto s e il prezzo da caselle di testo nel `EditItemTemplate`e quindi chiamare il `ProductsBLL` classe s `UpdateProduct` prima della restituzione DataList (metodo) lo stato di pre-modifica.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="ebf3b-141">Per il momento, s consentono di usare semplicemente esattamente lo stesso codice dal `UpdateCommand` gestore dell'evento nel *Panoramica della modifica e l'eliminazione di dati in DataList* esercitazione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="ebf3b-142">Verrà aggiunto il codice per gestire correttamente le eccezioni nel passaggio 2.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="ebf3b-143">In caso di input non valido che può essere sotto forma di un prezzo unitario formattato in modo errato, un valore del prezzo di unità non valida come - 5.00$ o l'omissione del nome del prodotto di s che verrà generata un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="ebf3b-144">Poiché il `UpdateCommand` gestore dell'evento non include eventuali eccezioni codice a questo punto, l'eccezione passerà al runtime di ASP.NET, in cui verrà visualizzato all'utente finale (vedere la figura 3).</span><span class="sxs-lookup"><span data-stu-id="ebf3b-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>


![Quando si verifica un'eccezione non gestita, l'utente finale vedrà una pagina di errore](handling-bll-and-dal-level-exceptions-cs/_static/image7.png)

<span data-ttu-id="ebf3b-146">**Figura 3**: quando si verifica un'eccezione non gestita, l'utente finale vedrà una pagina di errore</span><span class="sxs-lookup"><span data-stu-id="ebf3b-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="ebf3b-147">Passaggio 2: Normalmente la gestione delle eccezioni nel gestore eventi UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="ebf3b-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="ebf3b-148">Durante l'aggiornamento del flusso di lavoro, possono verificarsi eccezioni nel `UpdateCommand` DAL gestore eventi o il livello Business LOGIC.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="ebf3b-149">Ad esempio, se un utente immette un prezzo di troppi costosi, il `Decimal.Parse` istruzione il `UpdateCommand` gestore genererà un `FormatException` eccezione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="ebf3b-150">Se si omette il nome del prodotto s o se il prezzo ha un valore negativo, DAL genererà un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="ebf3b-151">Quando si verifica un'eccezione, si vuole visualizzare un messaggio informativo all'interno della pagina stessa.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="ebf3b-152">Aggiungere un'etichetta di Web controllo alla pagina di cui `ID` è impostato su `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="ebf3b-153">Configurare il testo dell'etichetta s per visualizzare in rosso, molto grande, tipo di carattere grassetto e corsivo assegnando il relativo `CssClass` proprietà il `Warning` classe CSS, che è definito nel `Styles.css` file.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="ebf3b-154">Quando si verifica un errore, è necessario solo l'etichetta da visualizzare una sola volta.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="ebf3b-155">Vale a dire nei postback successivi, il messaggio di avviso etichetta s deve essere nascosto.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="ebf3b-156">Questo può essere eseguito cancellando entrambi l'etichetta s `Text` impostazioni o proprietà relativo `Visible` proprietà `False` nel `Page_Load` gestore dell'evento (come è stato fatto nel [BLL - gestione e le eccezioni DAL livello in una pagina ASP Pagina .NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) esercitazione) o disabilitare il supporto dello stato di visualizzazione etichetta s.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="ebf3b-157">Consente di utilizzare la seconda opzione s.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-157">Let s use the latter option.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample4.aspx)]

<span data-ttu-id="ebf3b-158">Quando viene generata un'eccezione, si verranno assegnato i dettagli dell'eccezione per il `ExceptionDetails` s controllo etichetta `Text` proprietà.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="ebf3b-159">Poiché lo stato di visualizzazione è disabilitato, nei postback successivi il `Text` modifiche a livello di codice di proprietà s andranno perse, eseguendo il ripristino di testo predefinita (una stringa vuota), quindi nascondendo il messaggio di avviso.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="ebf3b-160">Per determinare se è stato generato un errore per visualizzare un messaggio utile nella pagina, è necessario aggiungere un `Try ... Catch` blocco per il `UpdateCommand` gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="ebf3b-161">Il `Try` parte contiene codice che può causare un'eccezione, mentre il `Catch` blocco contiene il codice che viene eseguito in caso di un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="ebf3b-162">Estrarre il [nozioni fondamentali sulla gestione delle eccezioni](https://msdn.microsoft.com/en-us/library/2w8f0bss.aspx) sezione nella documentazione di .NET Framework per altre informazioni di `Try ... Catch` blocco.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/en-us/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="ebf3b-163">Quando viene generata un'eccezione di qualsiasi tipo dal codice all'interno di `Try` blocco, il `Catch` codice blocco s verrà avviata l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="ebf3b-164">Il tipo di eccezione che viene generata un'eccezione `DbException`, `NoNullAllowedException`, `ArgumentException`e così via dipende da quali, esattamente, comportato la di in primo luogo l'errore.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="ebf3b-165">Se esiste un problema s a livello di database, un `DbException` verrà generata.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="ebf3b-166">Se viene immesso un valore non valido per il `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, o `ReorderLevel` campi, un `ArgumentException` verrà generata, come è stato aggiunto il codice per convalidare i valori di campo nel `ProductsDataTable` classe (vedere il [ Creazione di un livello di logica di Business](../introduction/creating-a-business-logic-layer-cs.md) esercitazione).</span><span class="sxs-lookup"><span data-stu-id="ebf3b-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial).</span></span>

<span data-ttu-id="ebf3b-167">Possiamo fornire una spiegazione più utile all'utente finale basando il testo del messaggio del tipo di eccezione rilevata.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="ebf3b-168">Il codice seguente che è stato utilizzato in un form quasi identico nel [BLL - gestione e le eccezioni DAL livello in una pagina ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) esercitazione fornisce questo livello di dettaglio:</span><span class="sxs-lookup"><span data-stu-id="ebf3b-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial provides this level of detail:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample6.cs)]

<span data-ttu-id="ebf3b-169">Per completare questa esercitazione, chiamare semplicemente il `DisplayExceptionDetails` metodo il `Catch` blocco passando intercettato `Exception` istanza (`ex`).</span><span class="sxs-lookup"><span data-stu-id="ebf3b-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="ebf3b-170">Con il `Try ... Catch` bloccare sul posto, gli utenti vengono presentati con un messaggio di errore più descrittivo, come nelle figure 4 e 5 Mostra.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="ebf3b-171">Si noti che in caso di un'eccezione DataList rimangono in modalità di modifica.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="ebf3b-172">Infatti, quando si verifica l'eccezione, il flusso di controllo viene immediatamente reindirizzato per il `Catch` blocco, ignorando il codice che restituisce lo stato di pre-modifica DataList.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>


<span data-ttu-id="ebf3b-173">[![Viene visualizzato un messaggio di errore se si omette un campo obbligatorio](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span></span>

<span data-ttu-id="ebf3b-174">**Figura 4**: viene visualizzato un messaggio di errore se si omette un campo obbligatorio ([fare clic per visualizzare l'immagine ingrandita](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="ebf3b-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span></span>


<span data-ttu-id="ebf3b-175">[![Un messaggio di errore viene visualizzato quando immettendo un prezzo negativo](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span></span>

<span data-ttu-id="ebf3b-176">**Figura 5**: un messaggio di errore viene visualizzato quando immettendo un prezzo negativo ([fare clic per visualizzare l'immagine ingrandita](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="ebf3b-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span></span>


## <a name="summary"></a><span data-ttu-id="ebf3b-177">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="ebf3b-177">Summary</span></span>

<span data-ttu-id="ebf3b-178">GridView e ObjectDataSource fornire gestori di eventi di post-livello che includono informazioni su tutte le eccezioni generate durante l'aggiornamento e l'eliminazione del flusso di lavoro, nonché le proprietà che è possibile impostare per indicare se l'eccezione è stata gestito.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="ebf3b-179">Queste funzionalità, tuttavia, non sono disponibili quando si con DataList e si utilizza il livello Business LOGIC direttamente.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="ebf3b-180">In alternativa, è sono responsabili dell'implementazione di gestione delle eccezioni.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="ebf3b-181">In questa esercitazione è stato illustrato come aggiungere eccezioni per una s DataList modificabile, l'aggiornamento del flusso di lavoro aggiungendo un `Try ... Catch` blocco per il `UpdateCommand` gestore dell'evento.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="ebf3b-182">Se viene generata un'eccezione durante l'aggiornamento del flusso di lavoro, il `Catch` codice blocco s viene eseguita, la visualizzazione di informazioni utili nel `ExceptionDetails` etichetta.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="ebf3b-183">A questo punto, DataList non vengono effettuate operazioni per evitare le eccezioni che si verifichino in primo luogo.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="ebf3b-184">Anche se si sa che un prezzo negativo genererà un'eccezione, sono utili t ancora aggiunto alcuna funzionalità per evitare in modo proattivo che un utente l'immissione di input di questo tipo non valido.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-184">Even though we know that a negative price will result in an exception, we haven t yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="ebf3b-185">Nell'esercitazione successiva vedremo come ridurre le eccezioni causate da input dell'utente non valido tramite l'aggiunta di controlli di convalida nel `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="ebf3b-186">Buona programmazione!</span><span class="sxs-lookup"><span data-stu-id="ebf3b-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="ebf3b-187">Ulteriori informazioni</span><span class="sxs-lookup"><span data-stu-id="ebf3b-187">Further Reading</span></span>

<span data-ttu-id="ebf3b-188">Per ulteriori informazioni sugli argomenti trattati in questa esercitazione, vedere le risorse seguenti:</span><span class="sxs-lookup"><span data-stu-id="ebf3b-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="ebf3b-189">Linee guida di progettazione per le eccezioni</span><span class="sxs-lookup"><span data-stu-id="ebf3b-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/en-us/library/ms298399.aspx)
- <span data-ttu-id="ebf3b-190">[Gestori (ELMAH) e i moduli di registrazione errore](http://workspaces.gotdotnet.com/elmah) (una libreria open source per la registrazione degli errori)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="ebf3b-191">[Enterprise Library per .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (include il blocco applicazione di gestione eccezioni)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="ebf3b-192">Informazioni sull'autore</span><span class="sxs-lookup"><span data-stu-id="ebf3b-192">About the Author</span></span>

<span data-ttu-id="ebf3b-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), l'autore di sette libri e fondatore di [4GuysFromRolla](http://www.4guysfromrolla.com), ha lavorato con tecnologie Web di Microsoft dal 1998.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="ebf3b-194">Scott funziona come un consulente trainer e writer.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="ebf3b-195">Il suo ultimo libro è [ *SAM insegna manualmente ASP.NET 2.0 nelle 24 ore*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="ebf3b-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="ebf3b-196">Egli può essere raggiunto al [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) o sul suo blog, cui è reperibile in [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="ebf3b-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="ebf3b-197">Ringraziamenti speciali</span><span class="sxs-lookup"><span data-stu-id="ebf3b-197">Special Thanks To</span></span>

<span data-ttu-id="ebf3b-198">Questa serie di esercitazioni è stata esaminata da diversi validi revisori.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-198">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="ebf3b-199">Il revisore per questa esercitazione è stata Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="ebf3b-199">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="ebf3b-200">Se si è interessati my prossimi articoli MSDN?</span><span class="sxs-lookup"><span data-stu-id="ebf3b-200">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="ebf3b-201">In caso affermativo, Inviami una riga alla [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-201">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="ebf3b-202">[Precedente](performing-batch-updates-cs.md)
[Successivo](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="ebf3b-202">[Previous](performing-batch-updates-cs.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span></span>
