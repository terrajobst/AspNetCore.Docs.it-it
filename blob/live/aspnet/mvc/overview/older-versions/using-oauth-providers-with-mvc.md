---
uid: mvc/overview/older-versions/using-oauth-providers-with-mvc
title: Utilizzo di provider OAuth con MVC 4 | Documenti Microsoft
author: tfitzmac
description: In questa esercitazione viene illustrato come compilare un'applicazione web ASP.NET MVC 4 che consente agli utenti di accedere con le credenziali da un provider esterno, ad esempio Facebo...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/19/2013
ms.topic: article
ms.assetid: 7a87f16f-0e19-4f15-a88a-094ae866c4a2
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions/using-oauth-providers-with-mvc
msc.type: authoredcontent
ms.openlocfilehash: 965d2e740cc76838b1b4e1c618a2a6d784672fcc
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 11/10/2017
---
<a name="using-oauth-providers-with-mvc-4"></a><span data-ttu-id="b0c41-103">Utilizzo di provider OAuth con MVC 4</span><span class="sxs-lookup"><span data-stu-id="b0c41-103">Using OAuth Providers with MVC 4</span></span>
====================
<span data-ttu-id="b0c41-104">da [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="b0c41-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="b0c41-105">In questa esercitazione viene illustrato come compilare un'applicazione web ASP.NET MVC 4 che consente agli utenti di accedere con le credenziali da un provider esterno, ad esempio Facebook, Twitter, Microsoft o Google e quindi integrerà alcune delle funzionalità di tali provider nel applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="b0c41-105">This tutorial shows you how to build an ASP.NET MVC 4 web application that enables users to log in with credentials from an external provider, such as Facebook, Twitter, Microsoft, or Google, and then integrate some of the functionality from those providers into your web application.</span></span> <span data-ttu-id="b0c41-106">Per semplicità, in questa esercitazione è incentrata sull'utilizzo di credenziali da Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-106">For simplicity, this tutorial focuses on working with credentials from Facebook.</span></span>
> 
> <span data-ttu-id="b0c41-107">Per usare le credenziali esterne in un'applicazione web ASP.NET MVC 5, vedere [creare un'App di ASP.NET MVC 5 con Facebook, Google OAuth2 e OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="b0c41-107">To use external credentials in an ASP.NET MVC 5 web application, see [Create an ASP.NET MVC 5 App with Facebook and Google OAuth2 and OpenID Sign-on](../security/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
> 
> <span data-ttu-id="b0c41-108">Abilitazione di queste credenziali in siti web offre un vantaggio significativo perché milioni di utenti dispongono già di account con tali provider esterni.</span><span class="sxs-lookup"><span data-stu-id="b0c41-108">Enabling these credentials in your web sites provides a significant advantage because millions of users already have accounts with these external providers.</span></span> <span data-ttu-id="b0c41-109">Questi utenti potrebbero essere più inclini a effettuare l'iscrizione per il sito se non dispone di creare e ricordare un nuovo insieme di credenziali.</span><span class="sxs-lookup"><span data-stu-id="b0c41-109">These users may be more inclined to sign up for your site if they do not have to create and remember a new set of credentials.</span></span> <span data-ttu-id="b0c41-110">Inoltre, dopo che un utente ha effettuato l'accesso tramite uno di questi provider, è possibile incorporare sociale operazioni dal provider.</span><span class="sxs-lookup"><span data-stu-id="b0c41-110">Also, after a user has logged in through one of these providers, you can incorporate social operations from the provider.</span></span>


## <a name="what-youll-build"></a><span data-ttu-id="b0c41-111">Occorre invece compilare</span><span class="sxs-lookup"><span data-stu-id="b0c41-111">What you'll build</span></span>

<span data-ttu-id="b0c41-112">In questa esercitazione sono disponibili due obiettivi principali:</span><span class="sxs-lookup"><span data-stu-id="b0c41-112">There are two main goals in this tutorial:</span></span>

1. <span data-ttu-id="b0c41-113">Consentire agli utenti di accedere con le credenziali da un provider OAuth.</span><span class="sxs-lookup"><span data-stu-id="b0c41-113">Enable a user to log in with credentials from an OAuth provider.</span></span>
2. <span data-ttu-id="b0c41-114">Recuperare informazioni sull'account dal provider e l'integrazione di tali informazioni con la registrazione dell'account per il sito.</span><span class="sxs-lookup"><span data-stu-id="b0c41-114">Retrieve account information from the provider and integrate that information with the account registration for your site.</span></span>

<span data-ttu-id="b0c41-115">Sebbene negli esempi inclusi in questa esercitazione è incentrata sull'uso di Facebook come provider di autenticazione, è possibile modificare il codice per utilizzare uno dei provider.</span><span class="sxs-lookup"><span data-stu-id="b0c41-115">Although the examples in this tutorial focus on using Facebook as the authentication provider, you can modify the code to use any of the providers.</span></span> <span data-ttu-id="b0c41-116">La procedura per implementare qualsiasi provider è molto simile a quelli visualizzati in questa esercitazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-116">The steps to implement any provider are very similar to the steps you will see in this tutorial.</span></span> <span data-ttu-id="b0c41-117">Si noterà solo differenze significative quando si effettuano chiamate dirette all'API del provider impostato.</span><span class="sxs-lookup"><span data-stu-id="b0c41-117">You will only notice significant differences when making direct calls to the provider's API set.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b0c41-118">Prerequisiti</span><span class="sxs-lookup"><span data-stu-id="b0c41-118">Prerequisites</span></span>

- <span data-ttu-id="b0c41-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) o [Microsoft Visual Studio Express 2012 per Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span><span class="sxs-lookup"><span data-stu-id="b0c41-119">[Microsoft Visual Studio 2012](https://www.microsoft.com/visualstudio/eng/downloads#vs) or [Microsoft Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/eng/downloads#d-2012-express)</span></span>

<span data-ttu-id="b0c41-120">Or</span><span class="sxs-lookup"><span data-stu-id="b0c41-120">Or</span></span>

- <span data-ttu-id="b0c41-121">Microsoft Visual Studio 2010 SP1 o [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span><span class="sxs-lookup"><span data-stu-id="b0c41-121">Microsoft Visual Studio 2010 SP1 or [Visual Web Developer Express 2010 SP1](https://www.microsoft.com/visualstudio/eng/downloads#d-2010-express)</span></span>
- [<span data-ttu-id="b0c41-122">ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="b0c41-122">ASP.NET MVC 4</span></span>](https://go.microsoft.com/fwlink/?LinkId=243392)

<span data-ttu-id="b0c41-123">Inoltre, questo argomento si presuppone di knowledge base su MVC ASP.NET e Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b0c41-123">Furthermore, this topic assumes you have basic knowledge about ASP.NET MVC and Visual Studio.</span></span> <span data-ttu-id="b0c41-124">Se occorre un'introduzione ad ASP.NET MVC 4, vedere [Intro to ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span><span class="sxs-lookup"><span data-stu-id="b0c41-124">If you need an introduction to ASP.NET MVC 4, see [Intro to ASP.NET MVC 4](getting-started-with-aspnet-mvc4/intro-to-aspnet-mvc-4.md).</span></span>

## <a name="create-the-project"></a><span data-ttu-id="b0c41-125">Creare il progetto</span><span class="sxs-lookup"><span data-stu-id="b0c41-125">Create the project</span></span>

<span data-ttu-id="b0c41-126">In Visual Studio, creare una nuova applicazione Web ASP.NET MVC 4 e denominarlo &quot;OAuthMVC&quot;.</span><span class="sxs-lookup"><span data-stu-id="b0c41-126">In Visual Studio, create a new ASP.NET MVC 4 Web Application, and name it &quot;OAuthMVC&quot;.</span></span> <span data-ttu-id="b0c41-127">È possibile usare .NET Framework 4.5 o 4.</span><span class="sxs-lookup"><span data-stu-id="b0c41-127">You can target either .NET Framework 4.5 or 4.</span></span>

![Crea progetto](using-oauth-providers-with-mvc/_static/image1.png)

<span data-ttu-id="b0c41-129">Nella finestra Nuovo progetto ASP.NET MVC 4, selezionare **applicazione Internet** e lasciare **Razor** come il motore di visualizzazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-129">In the New ASP.NET MVC 4 Project window, select **Internet Application** and leave **Razor** as the view engine.</span></span>

![Selezionare l'applicazione Internet](using-oauth-providers-with-mvc/_static/image2.png)

## <a name="enable-a-provider"></a><span data-ttu-id="b0c41-131">Abilitare un provider</span><span class="sxs-lookup"><span data-stu-id="b0c41-131">Enable a provider</span></span>

<span data-ttu-id="b0c41-132">Quando si crea un'applicazione web MVC 4 con il modello di applicazione Internet, il progetto è stato creato con un file denominato AuthConfig.cs nell'App\_cartella di avvio.</span><span class="sxs-lookup"><span data-stu-id="b0c41-132">When you create an MVC 4 web application with the Internet Application template, the project is created with a file named AuthConfig.cs in the App\_Start folder.</span></span>

![File AuthConfig](using-oauth-providers-with-mvc/_static/image3.png)

<span data-ttu-id="b0c41-134">Il file AuthConfig contiene codice per registrare i client per i provider di autenticazione esterno.</span><span class="sxs-lookup"><span data-stu-id="b0c41-134">The AuthConfig file contains code to register clients for external authentication providers.</span></span> <span data-ttu-id="b0c41-135">Per impostazione predefinita, questo codice è commentato, pertanto nessuno dei provider esterni sono abilitati.</span><span class="sxs-lookup"><span data-stu-id="b0c41-135">By default, this code is commented out, so none of the external providers are enabled.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample1.cs)]

<span data-ttu-id="b0c41-136">È necessario rimuovere il commento di questo codice per utilizzare il client di autenticazione esterno.</span><span class="sxs-lookup"><span data-stu-id="b0c41-136">You must uncomment this code to use the external authentication client.</span></span> <span data-ttu-id="b0c41-137">Rimuovere solo i provider che si desidera includere nel sito.</span><span class="sxs-lookup"><span data-stu-id="b0c41-137">You uncomment only the providers you want to include in your site.</span></span> <span data-ttu-id="b0c41-138">Per questa esercitazione, si abiliterà solo le credenziali di Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-138">For this tutorial, you will only enable the Facebook credentials.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample2.cs)]

<span data-ttu-id="b0c41-139">Si noti nell'esempio precedente che il metodo include stringhe vuote per i parametri di registrazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-139">Notice in the above example that the method includes empty strings for the registration parameters.</span></span> <span data-ttu-id="b0c41-140">Se si tenta di eseguire l'applicazione ora, l'applicazione genera un'eccezione di argomento, poiché le stringhe vuote non sono consentite per i parametri.</span><span class="sxs-lookup"><span data-stu-id="b0c41-140">If you try to run the application now, the application throws an argument exception because empty strings are not allowed for the parameters.</span></span> <span data-ttu-id="b0c41-141">Per fornire i valori validi, è necessario registrare il sito web con il provider esterni, come illustrato nella sezione successiva.</span><span class="sxs-lookup"><span data-stu-id="b0c41-141">To provide valid values, you must register your web site with the external providers, as shown in the next section.</span></span>

## <a name="registering-with-an-external-provider"></a><span data-ttu-id="b0c41-142">Registrazione con un provider esterno</span><span class="sxs-lookup"><span data-stu-id="b0c41-142">Registering with an external provider</span></span>

<span data-ttu-id="b0c41-143">Per autenticare gli utenti con le credenziali di un provider esterno, è necessario registrare il sito web con il provider.</span><span class="sxs-lookup"><span data-stu-id="b0c41-143">To authenticate users with credentials from an external provider, you must register your web site with the provider.</span></span> <span data-ttu-id="b0c41-144">Quando si registra il sito, si riceverà i parametri (ad esempio una chiave o l'id e segreto) in modo da includere durante la registrazione del client.</span><span class="sxs-lookup"><span data-stu-id="b0c41-144">When you register your site, you will receive the parameters (such as key or id, and secret) to include when registering the client.</span></span> <span data-ttu-id="b0c41-145">È necessario un account con i provider che si desidera utilizzare.</span><span class="sxs-lookup"><span data-stu-id="b0c41-145">You must have an account with the providers you wish to use.</span></span>

<span data-ttu-id="b0c41-146">In questa esercitazione non Mostra tutti i passaggi da eseguire per la registrazione con tali provider.</span><span class="sxs-lookup"><span data-stu-id="b0c41-146">This tutorial does not show all of the steps you must perform to register with these providers.</span></span> <span data-ttu-id="b0c41-147">I passaggi non sono in genere difficile.</span><span class="sxs-lookup"><span data-stu-id="b0c41-147">The steps are typically not difficult.</span></span> <span data-ttu-id="b0c41-148">Per registrare correttamente il sito, seguire le istruzioni fornite in questi siti.</span><span class="sxs-lookup"><span data-stu-id="b0c41-148">To successfully register your site, follow the instructions provided on those sites.</span></span> <span data-ttu-id="b0c41-149">Per iniziare con la registrazione del sito, vedere il sito per sviluppatori per:</span><span class="sxs-lookup"><span data-stu-id="b0c41-149">To get started with registering your site, see the developer site for:</span></span>

- [<span data-ttu-id="b0c41-150">Facebook</span><span class="sxs-lookup"><span data-stu-id="b0c41-150">Facebook</span></span>](https://developers.facebook.com/)
- [<span data-ttu-id="b0c41-151">Google</span><span class="sxs-lookup"><span data-stu-id="b0c41-151">Google</span></span>](https://developers.google.com/)
- [<span data-ttu-id="b0c41-152">Microsoft</span><span class="sxs-lookup"><span data-stu-id="b0c41-152">Microsoft</span></span>](http://manage.dev.live.com/)
- [<span data-ttu-id="b0c41-153">Twitter</span><span class="sxs-lookup"><span data-stu-id="b0c41-153">Twitter</span></span>](https://dev.twitter.com/)

<span data-ttu-id="b0c41-154">Quando si registra il sito con Facebook, è possibile fornire &quot;localhost&quot; per il dominio del sito e `&quot;http://localhost/&quot;` per l'URL, come illustrato nell'immagine seguente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-154">When registering your site with Facebook, you can provide &quot;localhost&quot; for the site domain and `&quot;http://localhost/&quot;` for the URL, as shown in the image below.</span></span> <span data-ttu-id="b0c41-155">Utilizzando localhost funziona con la maggior parte dei provider, ma attualmente non funziona con il provider di Microsoft.</span><span class="sxs-lookup"><span data-stu-id="b0c41-155">Using localhost works with most providers, but currently does not work with the Microsoft provider.</span></span> <span data-ttu-id="b0c41-156">Per il provider di Microsoft, è necessario includere un URL del sito web valido.</span><span class="sxs-lookup"><span data-stu-id="b0c41-156">For the Microsoft provider, you must include a valid web site URL.</span></span>

![registrazione del sito](using-oauth-providers-with-mvc/_static/image4.png)

<span data-ttu-id="b0c41-158">Nell'immagine precedente, i valori per l'id dell'app, segreto dell'app e posta elettronica di contatto sono state rimosse.</span><span class="sxs-lookup"><span data-stu-id="b0c41-158">In the previous image, the values for the app id, app secret, and contact email have been removed.</span></span> <span data-ttu-id="b0c41-159">Quando si registra effettivamente il sito, tali valori sarà presenti.</span><span class="sxs-lookup"><span data-stu-id="b0c41-159">When you actually register your site, those values will be present.</span></span> <span data-ttu-id="b0c41-160">È possibile notare i valori per l'id dell'app e chiave privata, perché verranno aggiunti all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-160">You will want to note the values for app id and app secret because you will add them to your application.</span></span>

## <a name="creating-test-users"></a><span data-ttu-id="b0c41-161">Creazione di utenti di test</span><span class="sxs-lookup"><span data-stu-id="b0c41-161">Creating test users</span></span>

<span data-ttu-id="b0c41-162">Se non è importante utilizzando un account Facebook esistente per eseguire il test del sito, è possibile ignorare questa sezione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-162">If you do not mind using an existing Facebook account to test your site, you can skip this section.</span></span>

<span data-ttu-id="b0c41-163">È possibile creare facilmente gli utenti di test per l'applicazione all'interno della pagina di gestione di app Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-163">You can easily create test users for your application within the Facebook app management page.</span></span> <span data-ttu-id="b0c41-164">È possibile utilizzare questi account per accedere al sito di test.</span><span class="sxs-lookup"><span data-stu-id="b0c41-164">You can use these test accounts to log in to your site.</span></span> <span data-ttu-id="b0c41-165">Per creare gli utenti di test scegliere il **ruoli** collegamento nel riquadro di spostamento a sinistra e la selezione di **crea** collegamento.</span><span class="sxs-lookup"><span data-stu-id="b0c41-165">You create test users by clicking the **Roles** link in the left navigation pane and the clicking the **Create** link.</span></span>

![creare utenti di test](using-oauth-providers-with-mvc/_static/image5.png)

<span data-ttu-id="b0c41-167">Il sito di Facebook crea automaticamente il numero di account di test richiesti.</span><span class="sxs-lookup"><span data-stu-id="b0c41-167">The Facebook site automatically creates the number of test accounts that you request.</span></span>

## <a name="adding-application-id-and-secret-from-the-provider"></a><span data-ttu-id="b0c41-168">Aggiunta dell'id applicazione e il segreto dal provider</span><span class="sxs-lookup"><span data-stu-id="b0c41-168">Adding application id and secret from the provider</span></span>

<span data-ttu-id="b0c41-169">Ora che hai ricevuto l'id e il segreto da Facebook, tornare al file AuthConfig e aggiungerli come i valori dei parametri.</span><span class="sxs-lookup"><span data-stu-id="b0c41-169">Now that you have received the id and secret from Facebook, go back to the AuthConfig file and add them as the parameter values.</span></span> <span data-ttu-id="b0c41-170">I valori seguenti non sono valori reali.</span><span class="sxs-lookup"><span data-stu-id="b0c41-170">The values shown below are not real values.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample3.cs)]

## <a name="log-in-with-external-credentials"></a><span data-ttu-id="b0c41-171">Accedere con le credenziali esterne</span><span class="sxs-lookup"><span data-stu-id="b0c41-171">Log in with external credentials</span></span>

<span data-ttu-id="b0c41-172">Questo è tutto che è necessario eseguire per abilitare le credenziali esterne nel sito.</span><span class="sxs-lookup"><span data-stu-id="b0c41-172">That is all you have to do to enable external credentials in your site.</span></span> <span data-ttu-id="b0c41-173">Eseguire l'applicazione e fare clic sul collegamento di account di accesso nell'angolo superiore destro.</span><span class="sxs-lookup"><span data-stu-id="b0c41-173">Run your application and click the login link in the upper right corner.</span></span> <span data-ttu-id="b0c41-174">Il modello riconosce automaticamente che si sono registrati Facebook come provider e include un pulsante per il provider.</span><span class="sxs-lookup"><span data-stu-id="b0c41-174">The template automatically recognizes that you have registered Facebook as a provider and includes a button for the provider.</span></span> <span data-ttu-id="b0c41-175">Se si registra più provider, un pulsante per ciascuno di essi viene incluso automaticamente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-175">If you register multiple providers, a button for each one is automatically included.</span></span>

![account di accesso esterno](using-oauth-providers-with-mvc/_static/image6.png)

<span data-ttu-id="b0c41-177">In questa esercitazione illustra come personalizzare il registro nei pulsanti per il provider esterni.</span><span class="sxs-lookup"><span data-stu-id="b0c41-177">This tutorial does not cover how to customize the log in buttons for the external providers.</span></span> <span data-ttu-id="b0c41-178">Per ulteriori informazioni, vedere [personalizzazione dell'interfaccia utente dell'account di accesso quando si utilizza OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span><span class="sxs-lookup"><span data-stu-id="b0c41-178">For that information, see [Customizing the login UI when using OAuth/OpenID](https://blogs.msdn.com/b/pranav_rastogi/archive/2012/08/24/customizing-the-login-ui-when-using-oauth-openid.aspx).</span></span>

<span data-ttu-id="b0c41-179">Fare clic sul pulsante Facebook per l'accesso con credenziali di Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-179">Click on the Facebook button to log in with Facebook credentials.</span></span> <span data-ttu-id="b0c41-180">Quando si seleziona uno dei provider esterni, è reindirizzato a un sito ed richiesto dal servizio di accesso.</span><span class="sxs-lookup"><span data-stu-id="b0c41-180">When you select one of the external providers, you are redirected to that site and prompted by that service to log in.</span></span>

<span data-ttu-id="b0c41-181">La figura seguente mostra la schermata di accesso per Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-181">The following image shows the login screen for Facebook.</span></span> <span data-ttu-id="b0c41-182">Viene rilevato che si utilizza l'account Facebook per l'accesso a un sito denominato oauthmvcexample.</span><span class="sxs-lookup"><span data-stu-id="b0c41-182">It notes that you are using your Facebook account to log in to a site named oauthmvcexample.</span></span>

![autenticazione di Facebook](using-oauth-providers-with-mvc/_static/image7.png)

<span data-ttu-id="b0c41-184">Dopo l'accesso con le credenziali di Facebook, una pagina informa l'utente che il sito sarà possibile accedere alle informazioni di base.</span><span class="sxs-lookup"><span data-stu-id="b0c41-184">After logging in with Facebook credentials, a page informs the user that the site will have access to basic information.</span></span>

![richiedere l'autorizzazione](using-oauth-providers-with-mvc/_static/image8.png)

<span data-ttu-id="b0c41-186">Dopo aver selezionato **passare all'App**, l'utente deve registrare per il sito.</span><span class="sxs-lookup"><span data-stu-id="b0c41-186">After selecting **Go to App**, the user must register for the site.</span></span> <span data-ttu-id="b0c41-187">La figura seguente mostra la pagina di registrazione dopo che un utente ha effettuato con le credenziali di Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-187">The following image shows the registration page after a user has logged in with Facebook credentials.</span></span> <span data-ttu-id="b0c41-188">Il nome utente è in genere precompilato con un nome del provider.</span><span class="sxs-lookup"><span data-stu-id="b0c41-188">The user name is typically pre-filled with a name from the provider.</span></span>

![register](using-oauth-providers-with-mvc/_static/image9.png)

<span data-ttu-id="b0c41-190">Fare clic su **registrare** per completare la registrazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-190">Click **Register** to complete registration.</span></span> <span data-ttu-id="b0c41-191">Chiudere il browser.</span><span class="sxs-lookup"><span data-stu-id="b0c41-191">Close the browser.</span></span>

<span data-ttu-id="b0c41-192">È possibile visualizzare il nuovo account è stato aggiunto al database.</span><span class="sxs-lookup"><span data-stu-id="b0c41-192">You can see that the new account has been added to your database.</span></span> <span data-ttu-id="b0c41-193">In Esplora Server, aprire il **DefaultConnection** database e aprire il **tabelle** cartella.</span><span class="sxs-lookup"><span data-stu-id="b0c41-193">In Server Explorer, open the **DefaultConnection** database and open the **Tables** folder.</span></span>

![tabelle di database](using-oauth-providers-with-mvc/_static/image10.png)

<span data-ttu-id="b0c41-195">Fare doppio clic su di **UserProfile** tabella e selezionare **Mostra dati tabella**.</span><span class="sxs-lookup"><span data-stu-id="b0c41-195">Right-click the **UserProfile** table and select **Show Table Data**.</span></span>

![Mostra i dati](using-oauth-providers-with-mvc/_static/image11.png)

<span data-ttu-id="b0c41-197">Verrà visualizzato il nuovo account che è stato aggiunto.</span><span class="sxs-lookup"><span data-stu-id="b0c41-197">You will see the new account you added.</span></span> <span data-ttu-id="b0c41-198">Esaminare i dati in **pagina Web\_OAuthMembership** tabella.</span><span class="sxs-lookup"><span data-stu-id="b0c41-198">Look at the data in **webpage\_OAuthMembership** table.</span></span> <span data-ttu-id="b0c41-199">Verranno visualizzati ulteriori dati relativi al provider esterno per l'account che appena aggiunto.</span><span class="sxs-lookup"><span data-stu-id="b0c41-199">You will see more data related to the external provider for the account you just added.</span></span>

<span data-ttu-id="b0c41-200">Se si desidera abilitare l'autenticazione esterna, termine.</span><span class="sxs-lookup"><span data-stu-id="b0c41-200">If you only want to enable external authentication, you are done.</span></span> <span data-ttu-id="b0c41-201">Tuttavia, è possibile integrare ulteriormente informazioni dal provider nel nuovo processo di registrazione utente, come illustrato nelle sezioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="b0c41-201">However, you can further integrate information from the provider into the new user registration process, as shown in the following sections.</span></span>

## <a name="create-models-for-additional-user-information"></a><span data-ttu-id="b0c41-202">Creare modelli per le informazioni utente aggiuntive</span><span class="sxs-lookup"><span data-stu-id="b0c41-202">Create models for additional user information</span></span>

<span data-ttu-id="b0c41-203">Come evidenziato nelle sezioni precedenti, non è necessario recuperare informazioni aggiuntive per la registrazione dell'account predefinito funzionare.</span><span class="sxs-lookup"><span data-stu-id="b0c41-203">As you noticed in the previous sections, you do not need to retrieve any additional information for the built-in account registration to work.</span></span> <span data-ttu-id="b0c41-204">Tuttavia, provider esterni più passare nuovamente ulteriori informazioni sull'utente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-204">However, most external providers pass back additional information about the user.</span></span> <span data-ttu-id="b0c41-205">Nelle sezioni seguenti viene illustrato come mantenere tali informazioni e salvarlo in un database.</span><span class="sxs-lookup"><span data-stu-id="b0c41-205">The following sections show how to retain that information and save it to a database.</span></span> <span data-ttu-id="b0c41-206">In particolare, verranno mantenuti i valori per nome completo dell'utente, l'URI della pagina web personale dell'utente e un valore che indica se l'account ha verificato da Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-206">Specifically, you will retain values for the user's full name, the URI of the user's personal web page, and a value that indicates whether Facebook has verified the account.</span></span>

<span data-ttu-id="b0c41-207">Si utilizzerà [migrazioni Code First](https://msdn.microsoft.com/en-us/data/jj591621) per aggiungere una tabella per archiviare informazioni utente aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="b0c41-207">You will use [Code First Migrations](https://msdn.microsoft.com/en-us/data/jj591621) to add a table for storing additional user information.</span></span> <span data-ttu-id="b0c41-208">Si aggiunge la tabella a un database esistente, pertanto è necessario innanzitutto creare uno snapshot del database corrente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-208">You are adding the table to an existing database, so you will first need to create a snapshot of the current database.</span></span> <span data-ttu-id="b0c41-209">Creando uno snapshot del database corrente, è possibile creare in un secondo momento una migrazione che contiene solo la nuova tabella.</span><span class="sxs-lookup"><span data-stu-id="b0c41-209">By creating a snapshot of the current database, you can later create a migration that contains only the new table.</span></span> <span data-ttu-id="b0c41-210">Per creare uno snapshot del database corrente:</span><span class="sxs-lookup"><span data-stu-id="b0c41-210">To create a snapshot of the current database:</span></span>

1. <span data-ttu-id="b0c41-211">Aprire il **Console di gestione pacchetti**</span><span class="sxs-lookup"><span data-stu-id="b0c41-211">Open the **Package Manager Console**</span></span>
2. <span data-ttu-id="b0c41-212">Eseguire il comando **enable-migrations**</span><span class="sxs-lookup"><span data-stu-id="b0c41-212">Run the command **enable-migrations**</span></span>
3. <span data-ttu-id="b0c41-213">Eseguire il comando **IgnoreChanges migrazione aggiungere iniziale:**</span><span class="sxs-lookup"><span data-stu-id="b0c41-213">Run the command **add-migration initial –IgnoreChanges**</span></span>
4. <span data-ttu-id="b0c41-214">Eseguire il comando **Aggiorna database**</span><span class="sxs-lookup"><span data-stu-id="b0c41-214">Run the command **update-database**</span></span>

<span data-ttu-id="b0c41-215">A questo punto, aggiungere le nuove proprietà.</span><span class="sxs-lookup"><span data-stu-id="b0c41-215">Now, you will add the new properties.</span></span> <span data-ttu-id="b0c41-216">Nella cartella Models, aprire il file AccountModels.cs e trovare la classe RegisterExternalLoginModel.</span><span class="sxs-lookup"><span data-stu-id="b0c41-216">In the Models folder, open the AccountModels.cs file, and find the RegisterExternalLoginModel class.</span></span> <span data-ttu-id="b0c41-217">La classe RegisterExternalLoginModel contiene valori che provengono da provider di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-217">The RegisterExternalLoginModel class holds values that come back from the authentication provider.</span></span> <span data-ttu-id="b0c41-218">Aggiungere proprietà denominata FullName e collegamento, come evidenziato qui sotto.</span><span class="sxs-lookup"><span data-stu-id="b0c41-218">Add properties named FullName and Link, as highlighted below.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample4.cs?highlight=9-13)]

<span data-ttu-id="b0c41-219">Anche in AccountModels.cs, aggiungere una nuova classe denominata ExtraUserInformation.</span><span class="sxs-lookup"><span data-stu-id="b0c41-219">Also in AccountModels.cs, add a new class called ExtraUserInformation.</span></span> <span data-ttu-id="b0c41-220">Questa classe rappresenta la nuova tabella che verrà creata nel database.</span><span class="sxs-lookup"><span data-stu-id="b0c41-220">This class represents the new table which will be created in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample5.cs)]

<span data-ttu-id="b0c41-221">Nella classe UsersContext, aggiungere il codice evidenziato di seguito per creare una proprietà DbSet per la nuova classe.</span><span class="sxs-lookup"><span data-stu-id="b0c41-221">In the UsersContext class, add the highlighted code below to create a DbSet property for the new class.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample6.cs?highlight=9)]

<span data-ttu-id="b0c41-222">A questo punto si è pronti a creare la nuova tabella.</span><span class="sxs-lookup"><span data-stu-id="b0c41-222">You are now ready to create the new table.</span></span> <span data-ttu-id="b0c41-223">Aprire la Console di gestione pacchetti nuovamente e questa volta:</span><span class="sxs-lookup"><span data-stu-id="b0c41-223">Open the Package Manager Console again and this time:</span></span>

1. <span data-ttu-id="b0c41-224">Eseguire il comando **AddExtraUserInformation aggiungere-migrazione**</span><span class="sxs-lookup"><span data-stu-id="b0c41-224">Run the command **add-migration AddExtraUserInformation**</span></span>
2. <span data-ttu-id="b0c41-225">Eseguire il comando **Aggiorna database**</span><span class="sxs-lookup"><span data-stu-id="b0c41-225">Run the command **update-database**</span></span>

<span data-ttu-id="b0c41-226">La nuova tabella ora esiste nel database.</span><span class="sxs-lookup"><span data-stu-id="b0c41-226">The new table now exists in the database.</span></span>

## <a name="retrieve-the-additional-data"></a><span data-ttu-id="b0c41-227">Recuperare i dati aggiuntivi</span><span class="sxs-lookup"><span data-stu-id="b0c41-227">Retrieve the additional data</span></span>

<span data-ttu-id="b0c41-228">Esistono due modi per recuperare i dati utente aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="b0c41-228">There are two ways to retrieve additional user data.</span></span> <span data-ttu-id="b0c41-229">La prima consiste nel conservare i dati utente che viene passati nuovamente, per impostazione predefinita, durante la richiesta di autenticazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-229">The first way is to retain user data that is passed back, by default, during the authentication request.</span></span> <span data-ttu-id="b0c41-230">Il secondo modo consiste in particolare, chiamare l'API del provider e richiedere altre informazioni.</span><span class="sxs-lookup"><span data-stu-id="b0c41-230">The second way is to specifically call the provider API and request more information.</span></span> <span data-ttu-id="b0c41-231">I valori per nome completo e collegamento vengono passati automaticamente indietro di Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-231">Values for FullName and Link are automatically passed back by Facebook.</span></span> <span data-ttu-id="b0c41-232">Viene recuperato un valore che indica se l'account ha verificato da Facebook tramite una chiamata all'API di Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-232">A value that indicates whether Facebook has verified the account is retrieved through a call to the Facebook API.</span></span> <span data-ttu-id="b0c41-233">Innanzitutto, verranno inseriti i valori per nome completo e di collegamento e quindi in un secondo momento, si otterrà il valore verificato.</span><span class="sxs-lookup"><span data-stu-id="b0c41-233">First, you will populate values for FullName and Link, and then later, you will get the verified value.</span></span>

<span data-ttu-id="b0c41-234">Per recuperare i dati utente aggiuntive, aprire il **AccountController.cs** file nel **controller** cartella.</span><span class="sxs-lookup"><span data-stu-id="b0c41-234">To retrieve the additional user data, open the **AccountController.cs** file in the **Controllers** folder.</span></span>

<span data-ttu-id="b0c41-235">Questo file contiene la logica per la registrazione, la registrazione e la gestione degli account.</span><span class="sxs-lookup"><span data-stu-id="b0c41-235">This file contains the logic for logging, registering, and managing accounts.</span></span> <span data-ttu-id="b0c41-236">Notare in particolare, i metodi chiamati **ExternalLoginCallback** e **ExternalLoginConfirmation**.</span><span class="sxs-lookup"><span data-stu-id="b0c41-236">In particular, notice the methods called **ExternalLoginCallback** and **ExternalLoginConfirmation**.</span></span> <span data-ttu-id="b0c41-237">All'interno di questi metodi, è possibile aggiungere codice per personalizzare le operazioni di accesso esterno per l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-237">Within these methods, you can add code to customize external login operations for your application.</span></span> <span data-ttu-id="b0c41-238">La prima riga del **ExternalLoginCallback** metodo contiene:</span><span class="sxs-lookup"><span data-stu-id="b0c41-238">The first line of the **ExternalLoginCallback** method contains:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample7.cs)]

<span data-ttu-id="b0c41-239">Altri dati utente sono passati nel **ExtraData** proprietà del **AuthenticationResult** oggetto restituito dal **VerifyAuthentication** metodo.</span><span class="sxs-lookup"><span data-stu-id="b0c41-239">Additional user data is passed back in the **ExtraData** property of the **AuthenticationResult** object that is returned from the **VerifyAuthentication** method.</span></span> <span data-ttu-id="b0c41-240">Il client di Facebook contiene i seguenti valori di **ExtraData** proprietà:</span><span class="sxs-lookup"><span data-stu-id="b0c41-240">The Facebook client contains the following values in the **ExtraData** property:</span></span>

- <span data-ttu-id="b0c41-241">ID</span><span class="sxs-lookup"><span data-stu-id="b0c41-241">id</span></span>
- <span data-ttu-id="b0c41-242">name</span><span class="sxs-lookup"><span data-stu-id="b0c41-242">name</span></span>
- <span data-ttu-id="b0c41-243">collegamento</span><span class="sxs-lookup"><span data-stu-id="b0c41-243">link</span></span>
- <span data-ttu-id="b0c41-244">sesso</span><span class="sxs-lookup"><span data-stu-id="b0c41-244">gender</span></span>
- <span data-ttu-id="b0c41-245">accesstoken</span><span class="sxs-lookup"><span data-stu-id="b0c41-245">accesstoken</span></span>

<span data-ttu-id="b0c41-246">Altri provider avrà nella proprietà ExtraData dati simili, ma leggermente diversi.</span><span class="sxs-lookup"><span data-stu-id="b0c41-246">Other providers will have similar but slightly different data in the ExtraData property.</span></span>

<span data-ttu-id="b0c41-247">Se l'utente è di nuovo al sito, si recupererà alcuni dati aggiuntivi e passare alla visualizzazione di conferma che i dati.</span><span class="sxs-lookup"><span data-stu-id="b0c41-247">If the user is new to your site, you will retrieve some the additional data and pass that data to the confirmation view.</span></span> <span data-ttu-id="b0c41-248">L'ultimo blocco di codice nel metodo viene eseguito solo se l'utente è una novità per il sito.</span><span class="sxs-lookup"><span data-stu-id="b0c41-248">The last block of code in the method is run only if the user is new to your site.</span></span> <span data-ttu-id="b0c41-249">Sostituire la riga seguente:</span><span class="sxs-lookup"><span data-stu-id="b0c41-249">Replace the following line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample8.cs)]

<span data-ttu-id="b0c41-250">Con la riga seguente:</span><span class="sxs-lookup"><span data-stu-id="b0c41-250">With this line:</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample9.cs)]

<span data-ttu-id="b0c41-251">Questa modifica include solo i valori delle proprietà FullName e collegamento.</span><span class="sxs-lookup"><span data-stu-id="b0c41-251">This change merely includes values for the FullName and Link properties.</span></span>

<span data-ttu-id="b0c41-252">Nel **ExternalLoginConfirmation** (metodo), modificare il codice evidenziato seguente per salvare le informazioni utente aggiuntive.</span><span class="sxs-lookup"><span data-stu-id="b0c41-252">In the **ExternalLoginConfirmation** method, modify the code as highlighted below to save the additional user information.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample10.cs?highlight=4,7-13)]

## <a name="adjusting-the-view"></a><span data-ttu-id="b0c41-253">Regolazione della visualizzazione</span><span class="sxs-lookup"><span data-stu-id="b0c41-253">Adjusting the view</span></span>

<span data-ttu-id="b0c41-254">I dati utente aggiuntivi che è recuperare dal provider di verranno visualizzati nella pagina di registrazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-254">The additional user data that you retrieve from the provider will be displayed in the registration page.</span></span>

<span data-ttu-id="b0c41-255">Nel **viste**/**Account** cartella, aprire **ExternalLoginConfirmation.cshtml**.</span><span class="sxs-lookup"><span data-stu-id="b0c41-255">In the **Views**/**Account** folder, open **ExternalLoginConfirmation.cshtml**.</span></span> <span data-ttu-id="b0c41-256">Sotto il campo esistente per il nome utente, aggiungere i campi per FullName, collegamento e PictureLink.</span><span class="sxs-lookup"><span data-stu-id="b0c41-256">Below the existing field for user name, add fields for FullName, Link, and PictureLink.</span></span>

[!code-cshtml[Main](using-oauth-providers-with-mvc/samples/sample11.cshtml)]

<span data-ttu-id="b0c41-257">Si è ora quasi pronti per eseguire l'applicazione e registrare un nuovo utente con le informazioni aggiuntive salvate.</span><span class="sxs-lookup"><span data-stu-id="b0c41-257">You are now almost ready to run the application and register a new user with the additional information saved.</span></span> <span data-ttu-id="b0c41-258">È necessario disporre di un account che non è già registrato con il sito.</span><span class="sxs-lookup"><span data-stu-id="b0c41-258">You must have an account that is not already registered with the site.</span></span> <span data-ttu-id="b0c41-259">È possibile utilizzare un account di test diverso o eliminare le righe di **UserProfile** e **pagine Web\_OAuthMembership** tabelle per l'account che si desidera riutilizzare.</span><span class="sxs-lookup"><span data-stu-id="b0c41-259">You can either use a different test account, or delete the rows in the **UserProfile** and **webpages\_OAuthMembership** tables for the account you wish to reuse.</span></span> <span data-ttu-id="b0c41-260">Eliminando le righe, si garantisce che l'account viene registrato di nuovo.</span><span class="sxs-lookup"><span data-stu-id="b0c41-260">By deleting those rows, you will ensure that the account is registered again.</span></span>

<span data-ttu-id="b0c41-261">Eseguire l'applicazione e registrare il nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-261">Run the application and register the new user.</span></span> <span data-ttu-id="b0c41-262">Si noti che questa volta la pagina di conferma contiene più valori.</span><span class="sxs-lookup"><span data-stu-id="b0c41-262">Notice that this time the confirmation page contains more values.</span></span>

![register](using-oauth-providers-with-mvc/_static/image12.png)

<span data-ttu-id="b0c41-264">Dopo aver completato la registrazione, chiudere il browser.</span><span class="sxs-lookup"><span data-stu-id="b0c41-264">After completing registration, close the browser.</span></span> <span data-ttu-id="b0c41-265">Nel database per rilevare nuovi valori di **ExtraUserInformation** tabella.</span><span class="sxs-lookup"><span data-stu-id="b0c41-265">Look in the database to notice the new values in the **ExtraUserInformation** table.</span></span>

## <a name="install-nuget-package-for-facebook-api"></a><span data-ttu-id="b0c41-266">Installare il pacchetto NuGet per l'API di Facebook</span><span class="sxs-lookup"><span data-stu-id="b0c41-266">Install NuGet package for Facebook API</span></span>

<span data-ttu-id="b0c41-267">Facebook fornisce un [API](https://developers.facebook.com/docs/reference/apis/) che è possibile chiamare per eseguire operazioni.</span><span class="sxs-lookup"><span data-stu-id="b0c41-267">Facebook provides an [API](https://developers.facebook.com/docs/reference/apis/) that you can call to perform operations.</span></span> <span data-ttu-id="b0c41-268">È possibile chiamare l'API di Facebook indirizzando le richieste di invio HTTP o usando l'installazione di un pacchetto NuGet che facilita l'invio di tali richieste.</span><span class="sxs-lookup"><span data-stu-id="b0c41-268">You can call the Facebook API either by directing sending HTTP requests, or by using installing a NuGet package that facilitates sending those requests.</span></span> <span data-ttu-id="b0c41-269">Utilizzo di un pacchetto NuGet è indicato in questa esercitazione, ma l'installazione di NuGet pacchetto non è essenziale.</span><span class="sxs-lookup"><span data-stu-id="b0c41-269">Using a NuGet package is shown in this tutorial, but installing NuGet package is not essential.</span></span> <span data-ttu-id="b0c41-270">In questa esercitazione viene illustrato come utilizzare il pacchetto C# SDK di Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-270">This tutorial shows how to use the Facebook C# SDK package.</span></span> <span data-ttu-id="b0c41-271">Sono presenti altri pacchetti NuGet che semplificano le chiama l'API di Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-271">There are other NuGet packages that assist with calling the Facebook API.</span></span>

<span data-ttu-id="b0c41-272">Dal **Gestisci pacchetti NuGet** windows, selezionare il pacchetto C# SDK di Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-272">From the **Manage NuGet Packages** windows, select the Facebook C# SDK package.</span></span>

![installare il pacchetto](using-oauth-providers-with-mvc/_static/image13.png)

<span data-ttu-id="b0c41-274">Utilizzare il SDK di Facebook C# per chiamare un'operazione che richiede il token di accesso per l'utente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-274">You will use the Facebook C# SDK to call an operation that requires the access token for the user.</span></span> <span data-ttu-id="b0c41-275">La sezione successiva viene illustrato come ottenere il token di accesso.</span><span class="sxs-lookup"><span data-stu-id="b0c41-275">The next section shows how to get the access token.</span></span>

## <a name="retrieve-access-token"></a><span data-ttu-id="b0c41-276">Recuperare i token di accesso</span><span class="sxs-lookup"><span data-stu-id="b0c41-276">Retrieve access token</span></span>

<span data-ttu-id="b0c41-277">Provider esterni più passare nuovamente un token di accesso dopo aver verificate le credenziali dell'utente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-277">Most external providers pass back an access token after the user's credentials are verified.</span></span> <span data-ttu-id="b0c41-278">Questo token di accesso è molto importante perché consente di chiamare le operazioni che sono disponibili solo per gli utenti autenticati.</span><span class="sxs-lookup"><span data-stu-id="b0c41-278">This access token is very important because it enables you to call operations that are only available to authenticated users.</span></span> <span data-ttu-id="b0c41-279">Per recuperare e archiviare il token di accesso, pertanto, è essenziale quando si desidera fornire ulteriori funzionalità.</span><span class="sxs-lookup"><span data-stu-id="b0c41-279">Therefore, retrieving and storing the access token is essential when you want to provide more functionality.</span></span>

<span data-ttu-id="b0c41-280">A seconda del provider esterno, il token di accesso potrebbe essere valido solo per un limitato periodo di tempo.</span><span class="sxs-lookup"><span data-stu-id="b0c41-280">Depending on the external provider, the access token may be valid for only a limited amount of time.</span></span> <span data-ttu-id="b0c41-281">Per verificare di disporre di un token di accesso valido, si recupererà, ogni volta che l'utente esegue l'accesso e archiviarle come un valore di sessione anziché salvarlo in un database.</span><span class="sxs-lookup"><span data-stu-id="b0c41-281">To ensure that you have a valid access token, you will retrieve it each time the user logs in, and store it as a session value rather than save it to a database.</span></span>

<span data-ttu-id="b0c41-282">Nel **ExternalLoginCallback** (metodo), il token di accesso verrà passato nuovamente il **ExtraData** proprietà del **AuthenticationResult** oggetto.</span><span class="sxs-lookup"><span data-stu-id="b0c41-282">In the **ExternalLoginCallback** method, the access token is also passed back in the **ExtraData** property of the **AuthenticationResult** object.</span></span> <span data-ttu-id="b0c41-283">Aggiungere il codice evidenziato in **ExternalLoginCallback** per salvare il token di accesso nel **sessione** oggetto.</span><span class="sxs-lookup"><span data-stu-id="b0c41-283">Add the highlighted code to **ExternalLoginCallback** to save the access token in the **Session** object.</span></span> <span data-ttu-id="b0c41-284">Questo codice viene eseguito ogni volta che l'utente accede con un account Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-284">This code is run every time the user logs in with a Facebook account.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample12.cs?highlight=11-14)]

<span data-ttu-id="b0c41-285">Sebbene in questo esempio recupera un token di accesso da Facebook, è possibile recuperare il token di accesso da qualsiasi provider esterno tramite la stessa chiave denominata &quot;accesstoken&quot;.</span><span class="sxs-lookup"><span data-stu-id="b0c41-285">Although this example retrieves an access token from Facebook, you can retrieve the access token from any external provider through the same key named &quot;accesstoken&quot;.</span></span>

## <a name="logging-off"></a><span data-ttu-id="b0c41-286">Disconnessione</span><span class="sxs-lookup"><span data-stu-id="b0c41-286">Logging off</span></span>

<span data-ttu-id="b0c41-287">Il valore predefinito **disconnessione** metodo consente all'utente dall'applicazione, ma non registra tale utente dal provider esterno.</span><span class="sxs-lookup"><span data-stu-id="b0c41-287">The default **LogOff** method logs the user out of your application, but does not log the user out of the external provider.</span></span> <span data-ttu-id="b0c41-288">Per l'accesso dell'utente da Facebook e impedire che il token di persistenza dopo che l'utente è disconnesso, è possibile aggiungere il codice evidenziato di seguito per il **disconnessione** metodo il AccountController.</span><span class="sxs-lookup"><span data-stu-id="b0c41-288">To log the user out of Facebook, and prevent the token from persisting after the user has logged off, you can add the following highlighted code to the **LogOff** method in the AccountController.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample13.cs?highlight=6-14)]

<span data-ttu-id="b0c41-289">Il valore fornito nel `next` parametro è l'URL da utilizzare dopo la disconnessione da Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-289">The value you provide in the `next` parameter is the URL to use after the user has logged out of Facebook.</span></span> <span data-ttu-id="b0c41-290">Durante il test nel computer locale, fornire il numero di porta corretto per il sito locale.</span><span class="sxs-lookup"><span data-stu-id="b0c41-290">When testing on your local computer, you would provide the correct port number for your local site.</span></span> <span data-ttu-id="b0c41-291">Nell'ambiente di produzione, fornire una pagina predefinita, ad esempio contoso.com.</span><span class="sxs-lookup"><span data-stu-id="b0c41-291">In production, you would provide a default page, such as contoso.com.</span></span>

## <a name="retrieve-user-information-that-requires-the-access-token"></a><span data-ttu-id="b0c41-292">Recuperare le informazioni dell'utente che richiede il token di accesso</span><span class="sxs-lookup"><span data-stu-id="b0c41-292">Retrieve user information that requires the access token</span></span>

<span data-ttu-id="b0c41-293">Caso in cui è archiviato il token di accesso sia installato il pacchetto C# SDK Facebook, è possibile usarli insieme per richiedere all'utente informazioni aggiuntive provenienti da Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-293">Now that you have stored the access token and installed the Facebook C# SDK package, you can use them together to request additional user information from Facebook.</span></span> <span data-ttu-id="b0c41-294">Nel **ExternalLoginConfirmation** (metodo), creare un'istanza del **FacebookClient** classe passando il valore del token di accesso.</span><span class="sxs-lookup"><span data-stu-id="b0c41-294">In the **ExternalLoginConfirmation** method, create an instance of the **FacebookClient** class by passing the value of the access token.</span></span> <span data-ttu-id="b0c41-295">Il valore della richiesta di **verificato** proprietà per l'utente autenticato corrente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-295">Request the value of the **verified** property for the current, authenticated user.</span></span> <span data-ttu-id="b0c41-296">Il **verificato** proprietà indica se l'account tramite altri mezzi, ad esempio l'invio di un messaggio a un telefono cellulare è convalidato da Facebook.</span><span class="sxs-lookup"><span data-stu-id="b0c41-296">The **verified** property indicates whether Facebook has validated the account through some other means, such as sending a message to a cell phone.</span></span> <span data-ttu-id="b0c41-297">Salvare questo valore nel database.</span><span class="sxs-lookup"><span data-stu-id="b0c41-297">Save this value in the database.</span></span>

[!code-csharp[Main](using-oauth-providers-with-mvc/samples/sample14.cs?highlight=7-18,25)]

<span data-ttu-id="b0c41-298">Occorrerà nuovamente a eliminare i record nel database per l'utente o utilizzare un account Facebook diverso.</span><span class="sxs-lookup"><span data-stu-id="b0c41-298">You will again need to either delete the records in the database for the user, or use a different Facebook account.</span></span>

<span data-ttu-id="b0c41-299">Eseguire l'applicazione e registrare il nuovo utente.</span><span class="sxs-lookup"><span data-stu-id="b0c41-299">Run the application, and register the new user.</span></span> <span data-ttu-id="b0c41-300">Esaminare il **ExtraUserInformation** tabella per visualizzare il valore della proprietà verificato.</span><span class="sxs-lookup"><span data-stu-id="b0c41-300">Look at the **ExtraUserInformation** table to see the value for the Verified property.</span></span>

## <a name="conclusion"></a><span data-ttu-id="b0c41-301">Conclusione</span><span class="sxs-lookup"><span data-stu-id="b0c41-301">Conclusion</span></span>

<span data-ttu-id="b0c41-302">In questa esercitazione è stato creato un sito che si integra con Facebook per l'autenticazione utente e i dati di registrazione.</span><span class="sxs-lookup"><span data-stu-id="b0c41-302">In this tutorial, you created a site that is integrated with Facebook for user authentication and registration data.</span></span> <span data-ttu-id="b0c41-303">State illustrate le impostazioni predefinite che sono configurata per l'applicazione web MVC 4 e come personalizzare il comportamento predefinito.</span><span class="sxs-lookup"><span data-stu-id="b0c41-303">You learned about the default behavior that is set up for MVC 4 web application, and how to customize that default behavior.</span></span>

## <a name="related-topics"></a><span data-ttu-id="b0c41-304">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="b0c41-304">Related topics</span></span>

- [<span data-ttu-id="b0c41-305">Creare un'applicazione MVC ASP.NET con autenticazione e il database di SQL Server e distribuire in Azure App Service</span><span class="sxs-lookup"><span data-stu-id="b0c41-305">Create an ASP.NET MVC app with auth and SQL DB and deploy to Azure App Service</span></span>](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data)
